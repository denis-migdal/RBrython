var __webpack_modules__={116:(e,t,n)=>{n.d(t,{A:()=>r});const r='from RBM import __JS_OP__, __JS_WRITE__, boolean\n\nclass bool(boolean): # type: ignore (bool is Final)\n    def __new__(cls, arg: object, /) -> boolean:# -> Any | bool:\n        # can\'t use Python "if", "or" as we\'d have an infinite loop.\n        __JS_WRITE__("if(arg === true || arg === false) { return arg; }")\n        return type(arg).__bool__(arg) # type: ignore\n    def __eq__(self, o: object, /) -> boolean:\n        return __JS_OP__(self, "==", o)'},137:(e,t,n)=>{function r(){return function(e){--e.indent_level,e.w_line()}}n.d(t,{A:()=>r})},541:(e,t,n)=>{n.d(t,{A:()=>r});const r='from types import NotImplementedType\nfrom RBM import __JS_AS_NUMBER__, __JS_OP__, bigint\n\nclass int(bigint):\n\n    def __new__(cls, o: object, base: int, /) -> int:\n        if type(o) == str:\n            return __JS_RUN__( # type: ignore\n                \'\'\'\n                    (x, base) => {\n                        if( base !== 16)\n                            return BigInt(x);\n                        \n                        let result = 0n;\n                        for(let i = 2; i < x.length; ++i)\n                            result = result << 4n + BigInt( parseInt(this.slice(i, i+8), 16) );\n                        return result;\n                    }\n                \'\'\', o, base) # type: ignore\n        return type(o).__int__(o) # type: ignore\n    \n    def __eq__(self, o: object, /) -> bool:\n        return __JS_OP__(self, "==", o)\n\n\n    def __add__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "+", o)\n            case _      : return NotImplemented\n    \n    def __radd__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(o, "+", self)\n            case _      : return NotImplemented\n    \n\n    def __sub__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "-", o)\n            case _      : return NotImplemented\n    \n    def __rsub__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(o, "-", self)\n            case _      : return NotImplemented\n    \n    def __mul__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "*", o)\n            case _      : return NotImplemented\n    \n    def __rmul__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(o, "*", self)\n            case _      : return NotImplemented\n\n    def __pow__(self, o: object, mod: int|None = None, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "**", o)\n            case _      : return NotImplemented\n    \n    def __rpow__(self, o: object, mod: int|None = None, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(o, "**", self)\n            case _      : return NotImplemented\n\n    def __truediv__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(self),\n                                           "/",\n                                           __JS_AS_NUMBER__(o))\n            case _      : return NotImplemented\n    \n    def __rtruediv__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o),\n                                           "*",\n                                           __JS_AS_NUMBER__(self) )\n            case _      : return NotImplemented\n\n    def __mod__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "%", o)\n            case _      : return NotImplemented\n    \n    def __rmod__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "%", o)\n            case _      : return NotImplemented\n    \n    def __or__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "|", o)\n            case _      : return NotImplemented\n    \n    def __ror__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "|", o)\n            case _      : return NotImplemented\n\n    def __and__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "&", o)\n            case _      : return NotImplemented\n    \n    def __rand__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "&", o)\n            case _      : return NotImplemented\n        \n    def __xor__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "^", o)\n            case _      : return NotImplemented\n    \n    def __rxor__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "^", o)\n            case _      : return NotImplemented\n\n    def __lshift__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  ():\n                __JS_LOG__("INT")\n                return __JS_OP__(self, "<<", o)\n            case _      :\n                __JS_LOG__("OTHER", o)\n                return NotImplemented\n    \n    def __rlshift__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, "<<", o)\n            case _      : return NotImplemented\n\n    def __rshift__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, ">>", o)\n            case _      : return NotImplemented\n    \n    def __rrshift__(self, o: object, /) -> NotImplementedType|int:\n        match o:\n            case int  (): return __JS_OP__(self, ">>", o)\n            case _      : return NotImplemented\n    \n    ### unary operators ###\n    def __invert__(self, /) -> int:\n        return __JS_OP__("~", self)\n\n    def __neg__(self, /) -> int:\n        return __JS_OP__("-", self)\n    \n    def __abs__(self, /) -> int:\n         return __JS_RUN__("x => x < 0n ? -x : x", self) # type: ignore'},1236:(e,t,n)=>{n.d(t,{A:()=>r});const r='from RBM import __JS_OP__, __JS_WRITE__\n\nclass type:\n    def __new__(cls, o: object, /) -> type:\n        return __JS_WRITE__("$RB.getClass(o)") # pyright: ignore[reportReturnType]\n\n    def __call__(self, *args):\n        __JS_WRITE__("""\n                     let instance;\n                     const factory = this.prototype.__new__;\n                     if( factory !== undefined )\n                        instance = factory.call(self, ...args)\n                     else\n                        instance = new self(...args) // JS\n                     \n                     const init = this.prototype.__init__;\n                     if( init !== undefined)\n                        init.call(self, ...args)\n                     """)\n        return instance # type: ignore\n\n    def __eq__(self, b: object, /):\n        return __JS_OP__(self, "===", b)'},1328:(e,t,n)=>{n.d(t,{A:()=>_});var r=n(8119);function _(e,t){return(0,r.Qs)(t.result_type,r.dA)?e=>e.w_node(t):e(t)}},1336:(e,t,n)=>{function r(e){return null!=e&&"$name"in e.constructor}function _(e){return e.constructor.$name}function o(e){return e.constructor.$name}n.d(t,{VJ:()=>r,Vq:()=>_,wB:()=>o})},1406:(e,t,n)=>{function r(){return function(e){++e.indent_level,e.w_line()}}n.d(t,{A:()=>r})},1711:(e,t,n)=>{n.d(t,{A:()=>r});const r='from types import NotImplementedType\nfrom RBM import __JS_OP__, string\n\nclass str(string):\n    def __new__(cls, o: object, /) -> str:\n        return __JS_AS_STRING__(o) # type: ignore\n        #return type(o).__str__(o) # type: ignore\n    \n    def __eq__(self, o: object, /) -> bool:\n        return __JS_OP__(self, "==", o)\n\n    def __mul__(self, o: object, /) -> NotImplementedType|str:\n        match o:\n            case int  (): return __JS_WRITE__("self.repeat(Number(b))") # type: ignore\n            case _      : return NotImplemented\n    \n    def __rmul__(self, o: object, /) -> NotImplementedType|str:\n        match o:\n            case int  (): return __JS_WRITE__("self.repeat(Number(b))") # type: ignore\n            case _      : return NotImplemented'},2312:(e,t,n)=>{n.d(t,{A:()=>r});class r{}},3180:(e,t,n)=>{n.d(t,{A:()=>r});const r='from types import NotImplementedType\nfrom RBM import __JS_OP__, __JS_AS_NUMBER__, __JS_WRITE__, number\n\nclass float(number):\n    def __new__(cls, o: object, /) -> float:\n        if type(o) is str:\n            if o == "infinity" or o == "inf":\n                return __JS_WRITE__("Number.POSITIVE_INFINITY") # pyright: ignore[reportReturnType]\n            if o == "-infinity" or o == "-inf":\n                return __JS_WRITE__("Number.NEGATIVE_INFINITY") # pyright: ignore[reportReturnType]\n            return __JS_AS_NUMBER__(o)\n        return type(o).__float__(o) # type: ignore\n    \n    def __eq__(self, o: object, /) -> bool:\n        return __JS_OP__(self, "==", o)    \n\n    def __add__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(self, "+", o)\n            case int  (): return __JS_OP__(self, "+", __JS_AS_NUMBER__(o))\n            case _      : return NotImplemented\n\n    def __radd__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(o                  , "+", self)\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), "+", self)\n            case _      : return NotImplemented\n\n    def __sub__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(self, "-", o)\n            case int  (): return __JS_OP__(self, "-", __JS_AS_NUMBER__(o))\n            case _      : return NotImplemented\n\n    def __rsub__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(o                  , "-", self)\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), "-", self)\n            case _      : return NotImplemented\n\n    def __mul__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(self, "*", o)\n            case int  (): return __JS_OP__(self, "*", __JS_AS_NUMBER__(o))\n            case _      : return NotImplemented\n\n    def __rmul__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(o                  , "*", self)\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), "*", self)\n            case _      : return NotImplemented\n\n    def __truediv__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(self, "/", o)\n            case int  (): return __JS_OP__(self, "/", __JS_AS_NUMBER__(o))\n            case _      : return NotImplemented\n\n    def __rtruediv__(self, o: object, /) -> NotImplementedType|float:\n        match o:\n            case float(): return __JS_OP__(o                  , "/", self)\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), "/", self)\n            case _      : return NotImplemented\n\n    ### unary operators ###\n\n    def __neg__(self, /) -> float:\n        return __JS_OP__("-", self)\n    \n    def __int__(self, /) -> int:\n        return __JS_RUN__(\'(x) => Math.trunc(x)\', self) # type: ignore\n    \n    def __abs__(self, /) -> int:\n         return __JS_RUN__(\'(x) => Math.abs(x)\', self) # type: ignore'},4868:(e,t,n)=>{function r(){return function(e){e.w_line()}}n.d(t,{A:()=>r})},6057:(e,t,n)=>{n.d(t,{A:()=>_});var r=n(8119);function _(e){(e.symtab.typedSymbols||={})[e.node.name]={type:r.RK}}},6586:(e,t,n)=>{n.d(t,{t:()=>f});const r={bigint:"int",number:"float",string:"str",boolean:"bool"};function _(e){const t=typeof e;if("function"===t)return type;if("object"===t)return e.constructor;const n=globalThis[r[t]];if(void 0!==n)return n;throw new Error(`JS type ${t} not implemented yet`)}const o=globalThis.NotImplemented=Symbol();function s(e){return o}const i={eq:function(e){return this==e},add:s,sub:s,mul:s,truediv:s,floordiv:s,mod:s,pow:s,and:s,or:s,xor:s,lshift:s,rshift:s,radd:s,rsub:s,rmul:s,rtruediv:s,rfloordiv:s,rmod:s,rpow:s,rand:s,ror:s,rxor:s,rlshift:s,rrshift:s};let a=null;const l=Symbol();var c=n(8958);let u=null;const f=globalThis.$RB={op:function(e,t,n){const r=_(e);if(void 0===r)throw console.warn(e,t),new Error("?");let s=r.prototype[`__${t}__`];if(void 0===s){if("ne"===t)return!r.prototype.__eq__.call(e,n);"i"===t[0]&&(s=r.prototype[`__${t.slice(1)}__`]),void 0===s&&(s=i[t])}let a=s.call(e,n);if(a===o){const r=_(n);if(void 0===r)throw console.warn(n,"r"+t),new Error("?");a=r.prototype[`__r${t}__`].call(n,e)}return a},uop:function(e,t){const n=_(t);if(void 0===n)throw console.warn(t,e),new Error("?");return n.prototype[`__${e}__`].call(t)},call:function(e,...t){t[t.length-1]===l&&(t=t.slice(0,-1));let n=e.__call__;if(void 0===n){if(n=e,void 0!==n.prototype?.__new__){const e=_(n).prototype.__call__;if(void 0!==e)return e.call(n,...t)}if(r=n,!1===Object.getOwnPropertyDescriptors(r)?.prototype?.writable)return new n(...t)}var r;return n(...t)},mcall:function(e,t,...n){return n[n.length-1]===l&&(n=n.slice(0,-1)),void 0===e[t]?(void 0===e.prototype[t]&&console.warn(e,e.name,t),e.prototype[t].call(...n)):e[t](...n)},assert:function(e,t=""){if(!e)throw new Error(`Assertion failed: ${t}`)},attr:function(e,t){return t in e?e[t]:e.constructor[t]},setattr:function(e,t,n){return e[t]=n},getKW:function(){if(null===a)return{};const e=a;return a=null,e},setKW:function(e){return a=e,l},tmp:function(){return u},saveTmp:function(e){return u=e},withTmp:function(e){return u=null,e},getModule:async function(e){const t=c.a[e];if(void 0!==t)return t;if(e in globalThis)return c.a[e]=globalThis[e];if("__BRYTHON__"in globalThis&&e in __BRYTHON__.imported)return c.a[e]=__BRYTHON__.pyobj2jsob(__BRYTHON__.imported[e]);throw new Error(`module ${e} not found`)},getModuleSync:function(e){const t=c.a[e];if(void 0!==t)return t;if(e in globalThis)return c.a[e]=globalThis[e];if("__BRYTHON__"in globalThis&&e in __BRYTHON__.imported)return c.a[e]=__BRYTHON__.pyobj2jsob(__BRYTHON__.imported[e]);throw new Error(`module ${e} not found`)},getClass:_};globalThis.abs=function(e){return _(e).prototype.__abs__.call(e)},globalThis.range=function*(...e){let t=0n,n=e[0],r=1n;e.length>=2&&(t=e[0],n=e[1],3===e.length&&(r=e[2]));for(let e=t;e<n;e+=r)yield e},globalThis.Exception=function(e){throw new Error(e)};const m=Symbol();globalThis.__JS_SET_IVALUE__=(e,t)=>e[m]=t,globalThis.__JS_GET_IVALUE__=e=>e[m]},6706:(e,t,n)=>{n.d(t,{A:()=>_,D:()=>o});var r=n(1336);function _(e,t){const n=e.func,_=n.id;if(_ in t.macros)t.macros[_](t,...e.args);else{if("Attribute"===(0,r.Vq)(n)){const e=n;t.w`$RB.mcall(${e.value}, "${e.attr}", `}else t.w`$RB.call(${n}, `;o(e,t),t.w_str(")")}}function o(e,t){const n=e.args,r=e.keywords;for(let e=0;e<n.length;++e)t.w`${n[e]}, `;if(r.length){t.w`$RB.setKW({`;for(let e=0;e<r.length;++e)t.w`${r[e].arg}: ${r[e].value},`;t.w`})`}}},6894:(e,t,n)=>{function r(e){return function(t){t.w`bool(${e})`}}n.d(t,{A:()=>r})},8119:(e,t,n)=>{n.d(t,{Qs:()=>o,RK:()=>r,dA:()=>_});const r={},_={};function o(e,t){return void 0!==e&&e.type===t}},8958:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>RBrythonGlobalRunner,a:()=>modules});var _RBrython_rbry_runlib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6586),_interface__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2312);const modules={};class RBrythonGlobalRunner extends _interface__WEBPACK_IMPORTED_MODULE_1__.A{#e=modules;#t={};async run(e){return await this.runFunction(this.loadAsFunction(e))}runSync(e){return this.runSyncFunction(this.loadAsSyncFunction(e))}loadAsFunction(jscode){return eval(jscode)}async runFunction(e){return await e(_RBrython_rbry_runlib__WEBPACK_IMPORTED_MODULE_0__.t)}loadAsSyncFunction(jscode){return eval(jscode)}runSyncFunction(e){return e(_RBrython_rbry_runlib__WEBPACK_IMPORTED_MODULE_0__.t)}registerModule(e,t){this.#e[e]=t}getModule(e){return this.#e[e]}registerBuiltins(e){for(let t in e)this.registerBuiltin(t,e[t])}registerBuiltin(e,t){this.#t[e]=t,globalThis[e]=t}}},9050:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(1336),_=n(8119),o=n(6706);function s(e,t,n){if("Name"===(0,r.Vq)(e.func)&&void 0!==t.symtab.typedSymbols){const n=e.func.id,r=t.symtab.typedSymbols[n];if((0,_.Qs)(r,_.RK))return t.w`${n}(`,(0,o.D)(e,t),void t.w`)`}n(e,t)}},9704:(e,t,n)=>{n.d(t,{A:()=>_});var r=n(8119);function _(e){e.node.result_type={type:r.dA}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{A:()=>RBrython_dev});var RBrythonGlobalRunner=__webpack_require__(8958);class Engine{}var runlib=__webpack_require__(6586);const handlers={},emitter_handlers=handlers;function ClassDef(e,t){const n=e.name,r=e.body;if(t.w`var ${n} = (() =>{${t.hm.BB()}`,t.w`function ${n}(...args) {${t.hm.BB()}`,t.w`return type.prototype.__call__.call(${n}, ...args)`,t.w`${t.hm.BE()}}${t.hm.NL()}`,t.w`${n}.prototype.__new__ = function __new__(...args) {${t.hm.BB()}`,t.w`return Object.create(${n}.prototype)`,t.w`${t.hm.BE()}}${t.hm.BE()}`,(1!==e.bases.length||!["number","bigint","boolean","string"].includes(e.bases[0].id))&&e.bases.length>=1){t.w`${n}.prototype = Object.create(${e.bases[0]}.prototype);\n`;for(let r=1;r<e.bases.length;++r)t.w`Object.assign(${n}.prototype, ${e.bases[r]}.prototype);`;t.w`${n}.prototype.constructor = ${n};\n`}t.w_body(r),t.w`${t.hm.BB()}return ${n};${t.hm.BE()}})();`}function FunctionDef(e,t){const n=t.isMethod(),r=e.name,_=e.body;n&&t.w`${t.getName(-1)}.prototype.${r} = `;for(let n=0;n<e.decorator_list.length;++n)t.w`${e.decorator_list[n]}(`;t.w`function ${r} ${e.args}`,t.w_body(_),t.w`}`;for(let n=0;n<e.decorator_list.length;++n)t.w`)`}function Lambda(e,t){t.w`function ${e.args} return ${e.body}}`}function Arguments(e,t){t.w`(`;let n=0,r=0;const _=t.isMethod();_&&(e.posonlyargs.length?++n:++r);let o=e.posonlyargs.length+e.args.length-e.defaults.length;for(let r=n;r<e.posonlyargs.length;++r)t.w`${e.posonlyargs[r].arg}`,o>=r&&t.w` = ${e.defaults[r-o]}`,t.w`,`;o-=e.posonlyargs.length;for(let n=r;n<e.args.length;++n)t.w`_${e.args[n].arg}`,o>=n&&t.w` = ${e.defaults[e.posonlyargs.length+n-o]}`,t.w`,`;const s=void 0!==e.vararg;s&&t.w`...${e.vararg.arg}`;const i=e.args.length-r||void 0!==e.kwarg||e.kwonlyargs.length;if(i&&!s&&writeKW(e,t,r),t.w`){`,i&&s&&(t.w`${t.hm.BB()}var `,writeKW(e,t,r),t.w`;${t.hm.BE()}`),_){let n="";n=e.posonlyargs.length>0?e.posonlyargs[0].arg:e.args[0].arg,t.w`${t.hm.BB()}const ${n} = this;${t.hm.BE()}`}}function writeKW(e,t,n){t.w`{`;for(let r=n;r<e.args.length;++r)t.w`${e.args[r].arg} = _${e.args[r].arg}, `;for(let n=0;n<e.kwonlyargs.length;++n)t.w`${e.kwonlyargs[n].arg}`,void 0!==e.kw_defaults[n]&&t.w` = ${e.kw_defaults[n]}`,t.w`, `;void 0!==e.kwarg&&t.w`...${e.kwarg.arg}`,t.w`} = $RB.getKW()`}function Global(){}function Nonlocal(){}function Subscript(e,t){t.w`${e.value}[${e.slice}]`}function Assert(e,t){t.mode!==MODE.PROD&&t.w`$RB.assert( ${t.hm.bool(e.test)}, ${e.msg??""})`}function Pass(e){}function Return(e,t){t.w`return ${e.value}`}var ast=__webpack_require__(1336);const FUNCTION=0,CLASS=1,BODY=1,LOCAL_VAR=4096;class EmitContext{macros={};hm;mode;sync;handlers;jscode="";#n;constructor({opti:{handlers:e,hmacros:t},mode:n,sync:r},_,o){this.handlers=e,this.#n=[o],this.mode=n,this.macros=_,this.hm=t,this.sync=r}getScope(e){return this.symtab.symbols.$strings[e]}getName(e=0){return this.#n[this.#n.length-1+e].name}isTopLevel(){return 1===this.#n.length}isMethod(){const e=this.#n.length-1;return this.#n[e].type===FUNCTION&&this.#n[e-1].type===CLASS}get symtab(){return this.#n[this.#n.length-1]}w(e,...t){for(let n=0;n<t.length;++n){this.w_str(e[n]);const r=t[n];"function"==typeof r?r(this):(0,ast.VJ)(r)?this.w_node(r):Array.isArray(r)?this.w_body(r):this.jscode+=`${r}`}this.w_str(e[e.length-1])}w_str(e){return this.jscode+=e}indent_level=0;w_line(){const e="\n"+"  ".repeat(this.indent_level);this.jscode.endsWith(e)||(this.jscode+=e)}w_body(e){if(0!==e.length){++this.indent_level;for(let t=0;t<e.length;++t)this.w_line(),this.w_node(e[t]);--this.indent_level,this.w_line()}}w_node(e){const t=(0,ast.Vq)(e),n=this.handlers[t];if(void 0===n)throw console.warn(e),new Error(`Node type ${(0,ast.Vq)(e)} is unknown`);const r="FunctionDef"===t||"ClassDef"===t;r&&this.enter(e.name),e.js_start=this.jscode.length,n(e,this),e.js_end=this.jscode.length,r&&this.leave()}enter(e){const t=this.symtab.children.find((t=>t.name===e));return this.#n.push(t),t}leave(){this.#n.pop()}}function Assign(e,t){if("Attribute"!==(0,ast.Vq)(e.targets[0])){for(let n=1;n<e.targets.length;++n)(t.getScope(e.targets[n].id)&LOCAL_VAR||t.isTopLevel())&&t.w`var ${e.targets[n]};`;(t.getScope(e.targets[0].id)&LOCAL_VAR||t.isTopLevel())&&t.w`var `;for(let n=0;n<e.targets.length;++n)t.w`${e.targets[n]} = `;return t.w_node(e.value)}{const n=e.targets[0];t.w`$RB.setattr(${n.value}, "${n.attr}", ${e.value})`}}function Attribute(e,t){t.w`$RB.attr(${e.value}, "${e.attr}")`}function BinOp(e,t){const n=e.left,r=e.right,_=(0,ast.wB)(e.op),o=binops[_];if(void 0===o)throw new Error(`BinOp ${_} not impl`);t.w`$RB.op(${n}, "${o}", ${r})`}const binops={Add:"add",Sub:"sub",Mult:"mul",Div:"truediv",FloorDiv:"floordiv",Pow:"pow",Mod:"mod",BitOr:"or",BitAnd:"and",BitXor:"xor",LShift:"lshift",RShift:"rshift"};function AugAssign(e,t){const n=e.target,r=(0,ast.wB)(e.op),_=e.value,o=binops[r];if(void 0===o)throw new Error(`BinOp ${r} not impl`);t.w`${n} = $RB.op(${n}, "i${o}", ${_})`}var Call=__webpack_require__(6706);function Compare(e,t){const n=e.left,r=(0,ast.wB)(e.ops[0]),_=e.comparators[0];if("Is"===r)return void t.w`${n} === ${_}`;if("IsNot"===r)return void t.w`${n} !== ${_}`;const o=cmpops[r];if(void 0===o)throw console.warn(r),new Error(`CmpOp ${r} not impl`);t.w`$RB.op(${n}, "${o}", ${_})`}const cmpops={Eq:"eq",NotEq:"ne"};function UnaryOp(e,t){const n=e.operand,r=(0,ast.wB)(e.op);if("Not"===r)return void t.w`! ${t.hm.bool(n)}`;const _=uops[r];if(void 0===_)throw new Error(`UnaryOp ${r} not impl`);t.w`$RB.uop("${_}", ${n})`}const uops={Invert:"invert",USub:"neg",UAdd:"pos"};function Constant(e,t){const n=typeof e.value;if("object"===n){const n=e.value.__class__.__qualname__,r=e.value.value;if("float"===n)return t.w`${r}`;if("int"===n)return t.w`${r}n`;if("NoneType"===n)return t.w`null`}if("string"===n)return t.w`"${e.value}"`;if("number"===n)return t.w`${e.value}n`;if("boolean"===n)return t.w`${e.value}`;throw console.warn(e,n),new Error(`Unknown Cste ${n}`)}function Expr(e,t){t.w_node(e.value)}function Name(e,t){"__debug__"!==e.id?t.w_str(e.id):t.w`${t.mode===MODE.DEBUG}`}function JoinedStr(e,t){t.w_str("`");for(let n=0;n<e.values.length;++n){const r=e.values[n];"Constant"===(0,ast.Vq)(r)?t.w_str(r.value):t.w`\${${r.value}}`}t.w_str("`")}function If(e,t){t.w`if( ${t.hm.bool(e.test)} ){${e.body}}`;for(let n=0;n<e.orelse.length;++n){const r=e.orelse[n];"If"===(0,ast.Vq)(r)?t.w`else ${r}`:t.w`else{${r}}`}}function While(e,t){t.w`while( ${t.hm.bool(e.test)} ){${e.body}}`}function For(e,t){t.w`for(var ${e.target} of ${e.iter}){${e.body}}`}function Try(e,t){t.w`try{${e.body}}catch{${e.handlers[0].body}}`}function Match(e,t){t.w`{${t.hm.BB()}`,t.w`const tname = $RB.getClass(${e.subject}).name;${t.hm.NL()}`;for(let n=0;n<e.cases.length-1;++n){0!==n&&t.w`else `;const r=e.cases[n];t.w`if( tname === "${r.pattern.cls.id}"){${r.body}}`}t.w`else {${e.cases[e.cases.length-1].body}}`,t.w`${t.hm.BE()}}`}function Continue(e,t){t.w_str("continue;")}function Break(e,t){t.w_str("break;")}function Raise(e,t){t.w`throw ${e.exc};`}function ImportFrom(e,t){const n=e.module;if("RBM"===n)return;if("types"===n||"typing"===n)return;if("functools"===n)return void console.warn("Import not implemented yet");t.w`const {`;for(let n=0;n<e.names.length;++n){const r=e.names[n];let _="";void 0!==r.asname&&(_=`: ${r.asname}`),t.w`${r.name}${_},`}const r=t.isTopLevel()&&!t.sync?"await $RB.getModule":"$RB.getModuleSync";t.w`} = ${r}("${n}")`}function Import(e,t){for(let n=0;n<e.names.length;++n){const r=e.names[n],_=r.name;if("RBM"===_)continue;let o=r.asname;void 0===o&&(o=_);const s=t.isTopLevel()&&!t.sync?"await $RB.getModule":"$RB.getModuleSync";t.w`const ${o} = ${s}("${_}")`}}function BoolOp(e,t){const n=(0,ast.wB)(e.op);if("And"===n)return t.w`$RB.withTmp(bool($RB.saveTmp(${e.values[0]})) ? ${e.values[1]} : $RB.tmp() )`;if("Or"===n)return t.w`$RB.withTmp(bool($RB.saveTmp(${e.values[0]})) ? $RB.tmp() : ${e.values[1]} )`;throw new Error(`Unknown boolean operator ${n}`)}function globalExport(e,t){return`  globalThis.${e} = {${t.join(", ")}};\n`}function returnExport(e,t){return`  return {${t.join(", ")}};\n`}function moduleExport(e,t){return`  export {${t.join(", ")}};\n`}function brythonExport(e,t){return`  $B.imported["${e}"] = $B.jsobj2pyobj({${t.join(",")}});\n`}emitter_handlers.ClassDef=ClassDef,emitter_handlers.FunctionDef=FunctionDef,emitter_handlers.Lambda=Lambda,emitter_handlers.arguments=Arguments,emitter_handlers.Global=Global,emitter_handlers.Nonlocal=Nonlocal,emitter_handlers.Subscript=Subscript,emitter_handlers.Assert=Assert,emitter_handlers.Pass=Pass,emitter_handlers.Return=Return,emitter_handlers.Assign=Assign,emitter_handlers.Attribute=Attribute,emitter_handlers.AugAssign=AugAssign,emitter_handlers.BinOp=BinOp,emitter_handlers.Call=Call.A,emitter_handlers.Compare=Compare,emitter_handlers.UnaryOp=UnaryOp,emitter_handlers.Constant=Constant,emitter_handlers.Expr=Expr,emitter_handlers.Name=Name,emitter_handlers.JoinedStr=JoinedStr,emitter_handlers.If=If,emitter_handlers.While=While,emitter_handlers.For=For,emitter_handlers.Try=Try,emitter_handlers.Match=Match,emitter_handlers.Continue=Continue,emitter_handlers.Break=Break,emitter_handlers.Raise=Raise,emitter_handlers.ImportFrom=ImportFrom,emitter_handlers.Import=Import,emitter_handlers.BoolOp=BoolOp;const raw={defaults:{},transform:e=>e},handlers_handlers={FunctionDef:__webpack_require__(6057).A,Compare:__webpack_require__(9704).A},checker_handlers=handlers_handlers;function walk(e){const t=new Array;for(let n=0;n<e.ast.body.length;++n)t.push({symtab:e.symtable,node:e.ast.body[n]});const n=new Array;let r,_;for(;r=t.pop();){n.push(r);for(let e of getChildren(r.node))t.push({node:e,symtab:r.symtab});if(r.node.body){let e=r.symtab;const n=(0,ast.Vq)(r.node);"FunctionDef"!==n&&"ClassDef"!==n||(e=e.children.find((e=>e.name===r.node.name)));for(let n=0;n<r.node.body.length;++n)t.push({node:r.node.body[n],symtab:e})}}for(;_=n.pop();){const e=checker_handlers[(0,ast.Vq)(_.node)];void 0!==e&&e(_)}}function getChildren(e){return[...Object.values(e)].filter((e=>"object"==typeof e&&void 0!==e.constructor.$name))}const hmacros={NL:__webpack_require__(4868).A,BB:__webpack_require__(1406).A,BE:__webpack_require__(137).A,bool:__webpack_require__(6894).A},list=hmacros,SafeOpti=[__webpack_require__(9050).A],safe_handlers=SafeOpti,hmacros_SafeOpti=[__webpack_require__(1328).A],safe_hmacros=hmacros_SafeOpti;function patchHandlers(e,t){const n={...e};for(let r=0;r<t.length;++r){const _=t[r].name,o=e[_];n[_]=(e,n)=>{t[r](e,n,o)}}return n}function patchHMacros(e,t){const n={...e};for(let r=0;r<t.length;++r){const _=t[r].name,o=e[_];n[_]=(...e)=>t[r](o,...e)}return n}const safeHandlers=patchHandlers(emitter_handlers,safe_handlers),safeHmacros=patchHMacros(list,safe_hmacros),Optimizers={disabled:{handlers:emitter_handlers,hmacros:list,require_typechecker:!1},safe:{handlers:safeHandlers,hmacros:safeHmacros,require_typechecker:!0},unsafe:{handlers:safeHandlers,hmacros:safeHmacros,require_typechecker:!0}},optimizers=Optimizers;var MODE,EXPORT;!function(e){e[e.DEBUG=0]="DEBUG",e[e.TEST=1]="TEST",e[e.PROD=2]="PROD"}(MODE||(MODE={})),function(e){e[e.NONE=0]="NONE",e[e.GLOBAL=1]="GLOBAL",e[e.MODULE=2]="MODULE",e[e.RETURN=4]="RETURN",e[e.BRYTHON=8]="BRYTHON"}(EXPORT||(EXPORT={}));const EmitterDefaults={mode:0,target:raw,opti:optimizers.safe,exports:0,sync:!1};class Emitter{}class RBrythonEmitter extends Emitter{macros={};registerMacros(e){for(let t in e)this.macros[t]=e[t]}registerMacro(e,t){this.macros[e]=t}emit(e,t={}){const n="_",r=Object.assign({},EmitterDefaults,t.target?.defaults,t);r.opti.require_typechecker&&walk(e);const _=new EmitContext(r,this.macros,e.symtable),o=this.extractExportedSymbols(e);_.w_body(e.ast.body);let s=_.jscode;return 1&r.exports&&(s+=globalExport(n,o)),2&r.exports&&(s+=moduleExport(n,o)),4&r.exports&&(s+=returnExport(n,o)),8&r.exports&&(s+=brythonExport(n,o)),r.target.transform(s,r.sync)}extractExportedSymbols(e){const t=e.symtable.symbols.$strings;return Object.keys(t).filter((e=>4098===t[e]))}}const targets_function={defaults:{exports:EXPORT.RETURN},transform:(e,t)=>`(${t?"":"async "}function($RB){"use strict";${e}})`};class BaseEngine extends Engine{parser;emitter;runner;constructor(e,t,n){super(),this.parser=e,this.emitter=t,this.runner=n}async run(e,t){return await this.runner.run(this.emit(this.parse(e),{...t,target:targets_function}))}runSync(e,t){return this.runner.runSync(this.emit(this.parse(e),{...t,sync:!0,target:targets_function}))}async registerModule(e,t){"string"==typeof t&&(t=await this.run(t)),this.runner.registerModule(e,t)}registerModuleSync(e,t){"string"==typeof t&&(t=this.runSync(t)),this.runner.registerModule(e,t)}getModule(e){return this.runner.getModule(e)}registerBuiltins(e){"string"==typeof e&&(e=this.runSync(e)),this.runner.registerBuiltins(e)}registerBuiltin(e,t){this.runner.registerBuiltin(e,t)}registerMacros(e){this.emitter.registerMacros(e)}registerMacro(e,t){this.emitter.registerMacro(e,t)}parse(e){return this.parser(e,"_")}emit(e,t){return this.emitter.emit(e,t)}loadAsFunction(e){return this.runner.loadAsFunction(e)}runFunction(e){return this.runner.runFunction(e)}loadAsSyncFunction(e){return this.runner.loadAsSyncFunction(e)}runSyncFunction(e){return this.runner.runSyncFunction(e)}}function parse(e,t){const n=new $B.Parser(e,t,"file"),r=$B._PyPegen.run_parser(n),_=$B.future_features(r,t);return{filename:t,pycode:e,ast:r,symtable:$B._PySymtable_Build(r,t,_)}}function __JS_OP__(e,...t){if(2===t.length){const n=t[0].value;return void e.w`${n}${t[1]}`}const n=t[1].value;e.w`${t[0]} ${n} ${t[2]}`}function __JS_RUN__(e,t,...n){e.w`(${_JS_RUN_unescape(t.value)})(`;for(let t=0;t<n.length;++t)e.w`${n[t]},`;e.w`)`}function _JS_RUN_unescape(e){return e.replaceAll("\\n\\","\n")}function __JS_WRITE__(e,t){e.w_str(t.value.replaceAll("\\n\\\n","\n"))}function __JS_LOG__(e,...t){e.w_str("console.log(");for(let n=0;n<t.length;++n)e.w`${t[n]},`;e.w_str(");")}function __JS_AS_STRING__(e,t){e.w`\`\${${t}}\``}function __JS_AS_NUMBER__(e,t){e.w`Number(${t})`}const builtins={type:__webpack_require__(1236).A,int:__webpack_require__(541).A,bool:__webpack_require__(116).A,float:__webpack_require__(3180).A,str:__webpack_require__(1711).A};function RBrythonEngineFactory(){const e=new RBrythonEmitter,t=new RBrythonGlobalRunner.A,n=new BaseEngine(parse,e,t);n.registerMacros({__JS_OP__,__JS_AS_STRING__,__JS_AS_NUMBER__,__JS_LOG__,__JS_RUN__,__JS_WRITE__}),n.registerModule("JS",globalThis);for(let e of Object.values(builtins))n.registerBuiltins(e);return n}const RBrython_dev=RBrythonEngineFactory();var __webpack_exports__default=__webpack_exports__.A;export{__webpack_exports__default as default};
//# sourceMappingURL=index.js.map