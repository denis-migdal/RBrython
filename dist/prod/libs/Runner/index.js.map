{"version":3,"file":"libs/Runner/index.js","mappings":"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","sources":["webpack://rbrython/./src/rbry/corelib-aot/int.js","webpack://rbrython/./src/rbry/runners/interface.ts","webpack://rbrython/./src/rbry/runlib/helpers/getClass.ts","webpack://rbrython/./src/rbry/runlib/interface/op.ts","webpack://rbrython/./src/rbry/runlib/interface/KW.ts","webpack://rbrython/./src/rbry/runlib/interface/tmp.ts","webpack://rbrython/./src/rbry/runlib/index.ts","webpack://rbrython/./src/rbry/runlib/interface/uop.ts","webpack://rbrython/./src/rbry/runlib/interface/call.ts","webpack://rbrython/./src/rbry/runlib/helpers/isClass.ts","webpack://rbrython/./src/rbry/runlib/interface/mcall.ts","webpack://rbrython/./src/rbry/runlib/interface/assert.ts","webpack://rbrython/./src/rbry/runlib/interface/attr.ts","webpack://rbrython/./src/rbry/runlib/interface/setattr.ts","webpack://rbrython/./src/rbry/runlib/interface/getModule.ts","webpack://rbrython/./src/rbry/runlib/interface/getModuleSync.ts","webpack://rbrython/./src/rbry/corelib-aot/mfct.js","webpack://rbrython/./src/rbry/corelib-aot/bool.js","webpack://rbrython/./src/rbry/corelib-aot/str.js","webpack://rbrython/./src/rbry/corelib-aot/float.js","webpack://rbrython/./src/rbry/runners/RBrythonGlobalRunner.ts","webpack://rbrython/webpack/bootstrap","webpack://rbrython/webpack/runtime/define property getters","webpack://rbrython/webpack/runtime/hasOwnProperty shorthand","webpack://rbrython/./src/libs/Runner/index.ts"],"sourcesContent":["export default \";\\n;\\nvar int = (() =>{\\n        function int() {\\n            return Object.create(int.prototype);\\n        }\\n    int.prototype.__new__ = function __new__(o, base, ){const cls = this;\\n        if( $RB.op($RB.call(type, o, ), \\\"eq\\\", str) ) {\\n        return (\\n\\n                    (x, base) => {\\n\\n                        if( base !== 16)\\n\\n                            return BigInt(x);\\n\\n                        \\n\\n                        let result = 0n;\\n\\n                        for(let i = 2; i < x.length; ++i)\\n\\n                            result = result << 4n + BigInt( parseInt(this.slice(i, i+8), 16) );\\n\\n                        return result;\\n\\n                    }\\n\\n                )(o,base);\\n\\n    };\\nreturn $RB.mcall($RB.call(type, o, ), \\\"__int__\\\", o,  );\\n\\n    };\\nint.prototype.__eq__ = function __eq__(o, ){const self = this;\\n        return self == o;\\n\\n    };\\nint.prototype.__add__ = function __add__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self + o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__radd__ = function __radd__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return o + self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__sub__ = function __sub__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self - o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rsub__ = function __rsub__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return o - self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__mul__ = function __mul__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self * o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rmul__ = function __rmul__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return o * self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__pow__ = function __pow__(o, mod, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self ** o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rpow__ = function __rpow__(o, mod, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return o ** self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__div__ = function __div__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return Number(self) / Number(o);\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rdiv__ = function __rdiv__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return Number(o) * Number(self);\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__mod__ = function __mod__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self % o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rmod__ = function __rmod__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self % o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__or__ = function __or__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self | o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__ror__ = function __ror__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self | o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__and__ = function __and__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self & o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rand__ = function __rand__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self & o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__xor__ = function __xor__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self ^ o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rxor__ = function __rxor__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self ^ o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__lshift__ = function __lshift__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self << o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rlshift__ = function __rlshift__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self << o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rshift__ = function __rshift__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self >> o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__rrshift__ = function __rrshift__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self >> o;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nint.prototype.__invert__ = function __invert__(){const self = this;\\n        return ~self;\\n\\n    };\\nint.prototype.__neg__ = function __neg__(){const self = this;\\n        return -self;\\n\\n    };\\nint.prototype.__abs__ = function __abs__(){const self = this;\\n        return (x => x < 0n ? -x : x)(self);\\n\\n    };\\n\\n        return int;\\n    })();\\n    ;\\n\\nconst __exported__ = {int}\";","export type PyModule = Record<string, any>;\n\nexport default abstract class Runner {\n    \n    abstract run(jscode: string): Promise<PyModule>;\n    abstract runSync(jscode: string): PyModule;\n\n    abstract registerBuiltins(symbols: PyModule): void;\n    abstract registerBuiltin(name: string, value: any): void;\n\n    abstract registerModule(name: string, symbols: PyModule): void;\n    abstract      getModule(name: string): PyModule;\n\n    // low level\n    abstract loadAsFunction(jscode: string): (runlib: any) => Promise<PyModule>;\n    abstract runFunction(fct: (runlib: any) => Promise<PyModule>): Promise<PyModule>;\n\n    abstract loadAsSyncFunction(jscode: string): (runlib: any) => PyModule;\n    abstract runSyncFunction(fct: (runlib: any) => PyModule): PyModule;\n}","const mapper = {\n    \"bigint\" : \"int\",\n    \"number\" : \"float\",\n    \"string\" : \"str\",\n    \"boolean\": \"bool\"\n}\n\nexport function getClass(o: unknown) {\n\n    const typename = typeof o;\n\n    if( typename === \"function\" ) {\n        //TODO: is class ? is something else ?\n        // @ts-ignore\n        return type;\n    }\n\n    if( typename === \"object\" ) {\n        // @ts-ignore;\n        return o.constructor;\n    }\n\n    // @ts-ignore\n    const lit_class = globalThis[mapper[typename]];\n    if( lit_class !== undefined)\n        return lit_class;\n\n    throw new Error(`JS type ${typename} not implemented yet`);\n}","import { getClass } from \"../helpers/getClass\";\n\n// @ts-ignore\nconst NotImplemented = globalThis.NotImplemented = Symbol();\n\nexport default function op(a: unknown, op: string, b: unknown) {\n\n    const ka = getClass(a);\n\n    if( ka === undefined ) {\n        console.warn(a, op);\n        throw new Error(\"?\")\n    }\n\n    let fct = ka.prototype[`__${op}__`];\n\n    if( fct === undefined ) {\n        if( op === \"ne\" )\n            return ! ka.prototype[\"__eq__\"].call(a, b);\n        if( op[0] === \"i\")\n            fct = ka.prototype[`__${op.slice(1)}__`];\n        if( fct === undefined)\n            fct = defaults[op as keyof typeof defaults];\n    }\n    \n    let result = fct.call(a, b);\n\n    if( result === NotImplemented) {\n\n        const kb = getClass(b);\n        if( kb === undefined ) {\n            console.warn(b, \"r\" + op);\n            throw new Error(\"?\");\n        }\n\n        let fct = kb.prototype[`__r${op}__`];\n        result = fct.call(b, a);\n    }\n\n    return result;\n}\n\nfunction NI(b: unknown) { return NotImplemented }\n\n//TODO: move to corelib ?\nconst defaults = {\n    eq: function(b: unknown) { return this == b },\n\n    add: NI,\n    sub: NI,\n    mul: NI,\n    truediv: NI,\n    floordiv: NI,\n    mod: NI,\n    pow: NI,\n\n    and: NI,\n    or : NI,\n    xor: NI,\n    lshift: NI,\n    rshift: NI,\n\n    radd: NI,\n    rsub: NI,\n    rmul: NI,\n    rtruediv: NI,\n    rfloordiv: NI,\n    rmod: NI,\n    rpow: NI,\n\n    rand: NI,\n    ror : NI,\n    rxor: NI,\n    rlshift: NI,\n    rrshift: NI,\n}","export let KW: Record<string, any>|null = null;\n\nexport const IGNORE_ARG = Symbol();\n\nexport function setKW(args: Record<string, any>) {\n    KW = args;\n    return IGNORE_ARG;\n}\n\nexport function getKW() {\n    if( KW === null )\n        return {};\n    const args = KW;\n    KW = null;\n    return args;\n}","let _tmp: any = null;\n\nexport function saveTmp(v: any): any {\n    return _tmp = v;\n}\n\nexport function tmp(): any { // may reuse many time ?\n    return _tmp;\n}\nexport function withTmp(value: any): any {\n    _tmp = null;\n    return value;\n}\n\n/*\nexport function saveTmp(v: any): any {\n    return tmp = v;\n}\nexport function releaseTmp(v: any) {\n    tmp = null;\n    return v;\n}*/\n\n","// interface\nimport op     from \"./interface/op\";\nimport uop    from \"./interface/uop\";\nimport call   from \"./interface/call\";\nimport mcall  from \"./interface/mcall\";\nimport assert from \"./interface/assert\";\nimport attr   from \"./interface/attr\";\nimport setattr from \"./interface/setattr\";\nimport getModule from \"./interface/getModule\";\nimport { saveTmp, tmp, withTmp } from \"./interface/tmp\";\nimport { getKW, setKW } from \"./interface/KW\";\n\n// @ts-ignore\nconst $RB = globalThis.$RB = {\n    // interface\n    op,\n    uop,\n    call,\n    mcall,\n    assert,\n    attr,\n    setattr,\n    getKW,\n    setKW,\n    tmp,\n    saveTmp,\n    withTmp,\n    getModule,\n    getModuleSync,\n    getClass\n}\nexport {$RB};\n\n//TODO: corelib\nimport { getClass } from \"./helpers/getClass\";\nimport getModuleSync from \"./interface/getModuleSync\";\n\n// @ts-ignore\nglobalThis.abs = function( a: unknown) {\n    const ka = getClass(a);\n    return ka.prototype[`__abs__`].call(a);\n}\n\n// @ts-ignore\nglobalThis.range = function*(...args: bigint[]) {\n    let beg = 0n;\n    let end = args[0];\n    let inc = 1n;\n\n    if( args.length >= 2) {\n        beg = args[0]\n        end = args[1]\n\n        if( args.length === 3)\n            inc = args[2];\n    }\n\n    for(let i = beg; i < end; i+= inc)\n        yield i;\n}\n\n// @ts-ignore\nglobalThis.Exception = function(msg: string) {\n    throw new Error(msg);\n}\n\n// =====================================================\n\n//TODO: as macro...\nexport const IVALUE = Symbol();\n\n// @ts-ignore\nglobalThis.__JS_SET_IVALUE__ = (self, v) => self[IVALUE] = v;\n// @ts-ignore\nglobalThis.__JS_GET_IVALUE__ = (self) => self[IVALUE];","import { getClass } from \"../helpers/getClass\";\n\nexport default function uop(op:string, a: unknown) {\n\n    const ka = getClass(a);\n\n    if( ka === undefined ) {\n        console.warn(a, op);\n        throw new Error(\"?\")\n    }\n\n    let fct = ka.prototype[`__${op}__`];\n    return fct.call(a);\n}","import { getClass } from \"../helpers/getClass\";\nimport isClass from \"../helpers/isClass\";\nimport { IGNORE_ARG } from \"./KW\";\n\nexport default function call(a: (...args:unknown[]) => unknown, ...args: unknown[]) {\n\n    if( args[args.length-1] === IGNORE_ARG)\n        args = args.slice(0,-1);\n\n    // @ts-ignore\n    let fct = a.__call__\n\n    if( fct === undefined ) {\n        fct = a;\n\n        // h4cky\n        if( fct.prototype?.__new__ !== undefined ) {\n            const b = getClass(fct).prototype.__call__;\n            if( b !== undefined) {\n                return b.call(fct, ...args);\n            }\n        }\n\n        if( isClass(fct) ) // only for JS classes now...\n            return new fct(...args);\n    }\n\n    return fct(...args);\n}\n","export default function isClass(o: unknown) {\n    // from https://stackoverflow.com/questions/526559/testing-if-something-is-a-class-in-javascript\n    return Object.getOwnPropertyDescriptors(o)?.prototype?.writable === false;\n}\n// + https://github.com/brython-dev/brython/issues/2513","import { IGNORE_ARG } from \"./KW\";\n\nexport default function mcall(o: unknown, name: string, ...args: unknown[]) {\n    \n    if( args[args.length-1] === IGNORE_ARG)\n        args = args.slice(0,-1);\n    \n    // @ts-ignore\n    let fct = o[name];\n    if( fct === undefined) {\n        // @ts-ignore\n        if( o.prototype[name] === undefined) {\n            // @ts-ignore\n            console.warn(o, o.name, name);\n        }\n        // @ts-ignore\n        return o.prototype[name].call(...args);\n    }\n\n    // @ts-ignore\n    return o[name](...args);\n}","export default function assert(cond: boolean, msg: string = \"\") {\n    if( ! cond )\n        throw new Error(`Assertion failed: ${msg}`);\n}","export default function attr(o: any, attr: string) {\n    if( ! (attr in o) )\n        return o.constructor[attr];\n    return o[attr];\n}","export default function setattr(obj: object, key: string, value:unknown) {\n    // @ts-ignore\n    return obj[key] = value;\n}","import { modules } from \"@RBrython/rbry/runners/RBrythonGlobalRunner\";\n\nexport default async function getModule(name: string) {\n\n    // h4ck\n    const module = modules[name];\n    if( module !== undefined )\n        return module;\n\n    if( name in globalThis)\n        return modules[name] = globalThis[name as keyof typeof globalThis];\n\n    // TODO...\n    if( \"__BRYTHON__\" in globalThis) {\n        // @ts-ignore\n        if( name in __BRYTHON__.imported)\n            // @ts-ignore\n            return modules[name] = __BRYTHON__.pyobj2jsob(__BRYTHON__.imported[name]);\n    }\n    \n    throw new Error(`module ${name} not found`);\n}\n    ","import { modules } from \"@RBrython/rbry/runners/RBrythonGlobalRunner\";\n\nexport default function getModuleSync(name: string) {\n\n    // h4ck\n    const module = modules[name];\n    if( module !== undefined )\n        return module;\n\n    if( name in globalThis)\n        return modules[name] = globalThis[name as keyof typeof globalThis];\n\n    // TODO...\n    if( \"__BRYTHON__\" in globalThis) {\n        // @ts-ignore\n        if( name in __BRYTHON__.imported)\n            // @ts-ignore\n            return modules[name] = __BRYTHON__.pyobj2jsob(__BRYTHON__.imported[name]);\n    }\n    \n    throw new Error(`module ${name} not found`);\n}\n    ","export default \"function abs(o, ){\\n        return $RB.mcall(o, \\\"__abs__\\\",  );\\n\\n    };\\n\\nconst __exported__ = {abs}\";","export default \";\\nvar bool = (() =>{\\n        function bool() {\\n            return Object.create(bool.prototype);\\n        }\\n    bool.prototype.__eq__ = function __eq__(o, ){const self = this;\\n        return self == o;\\n\\n    };\\n\\n        return bool;\\n    })();\\n    ;\\n\\nconst __exported__ = {bool}\";","export default \";\\n;\\nvar str = (() =>{\\n        function str() {\\n            return Object.create(str.prototype);\\n        }\\n    str.prototype.__new__ = function __new__(o, ){const cls = this;\\n        return `${o}`;\\n\\n    };\\nstr.prototype.__eq__ = function __eq__(o, ){const self = this;\\n        return self == o;\\n\\n    };\\nstr.prototype.__mul__ = function __mul__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self.repeat(Number(b));\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nstr.prototype.__rmul__ = function __rmul__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"int\\\") {\\n            return self.repeat(Number(b));\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\n\\n        return str;\\n    })();\\n    ;\\n\\nconst __exported__ = {str}\";","export default \";\\n;\\nvar float = (() =>{\\n        function float() {\\n            return Object.create(float.prototype);\\n        }\\n    float.prototype.__new__ = function __new__(o, ){const cls = this;\\n        if( $RB.call(type, o, ) === str ) {\\n        if( $RB.op(o, \\\"eq\\\", \\\"infinity\\\")||$RB.op(o, \\\"eq\\\", \\\"inf\\\") ) {\\n        return Number.POSITIVE_INFINITY;\\n\\n    };\\nif( $RB.op(o, \\\"eq\\\", \\\"-infinity\\\")||$RB.op(o, \\\"eq\\\", \\\"-inf\\\") ) {\\n        return Number.NEGATIVE_INFINITY;\\n\\n    };\\nreturn Number(o);\\n\\n    };\\nreturn $RB.mcall($RB.call(type, o, ), \\\"__float__\\\", o,  );\\n\\n    };\\nfloat.prototype.__eq__ = function __eq__(o, ){const self = this;\\n        return self == o;\\n\\n    };\\nfloat.prototype.__add__ = function __add__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return self + o;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return self + Number(o);\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__radd__ = function __radd__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return o + self;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return Number(o) + self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__sub__ = function __sub__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return self - o;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return self - Number(o);\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__rsub__ = function __rsub__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return o - self;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return Number(o) - self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__mul__ = function __mul__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return self * o;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return self * Number(o);\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__rmul__ = function __rmul__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return o * self;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return Number(o) * self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__div__ = function __div__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return self / o;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return self / Number(o);\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__rdiv__ = function __rdiv__(o, ){const self = this;\\n        {const tname = type(o).name;if( tname === \\\"float\\\") {\\n            return o / self;\\n\\n        }else if( tname === \\\"int\\\") {\\n            return Number(o) / self;\\n\\n        }else {\\n            return NotImplemented;\\n\\n    }};\\n\\n    };\\nfloat.prototype.__neg__ = function __neg__(){const self = this;\\n        return -self;\\n\\n    };\\nfloat.prototype.__int__ = function __int__(){const self = this;\\n        return ((x) => Math.trunc(x))(self);\\n\\n    };\\nfloat.prototype.__abs__ = function __abs__(){const self = this;\\n        return ((x) => Math.abs(x))(self);\\n\\n    };\\n\\n        return float;\\n    })();\\n    ;\\n\\nconst __exported__ = {float}\";","import \"@RBrython/rbry/runlib\";\n\nimport Runner, { PyModule } from \"./interface\";\nimport { $RB } from \"@RBrython/rbry/runlib\";\n\nexport const modules: Record<string, any> = {};\n\nexport default class RBrythonGlobalRunner extends Runner {\n\n    #module   = modules; // h4ck\n    #builtins: Record<string, any> = {};\n\n    override async run(jscode: string) {\n        return await this.runFunction( this.loadAsFunction(jscode) );\n    }\n    override runSync(jscode: string) {\n        return this.runSyncFunction( this.loadAsSyncFunction(jscode) );\n    }\n\n    override loadAsFunction(jscode: string): (runlib: any) => Promise<PyModule> {\n        return eval(jscode) as (runlib: any) => Promise<PyModule>;\n    }\n    override async runFunction( fct: (runlib: any) => Promise<PyModule> ) {\n        return await fct($RB);\n    }\n\n    override loadAsSyncFunction(jscode: string): (runlib: any) => PyModule {\n        return eval(jscode) as (runlib: any) => PyModule;\n    }\n    override runSyncFunction( fct: (runlib: any) => PyModule ) {\n        return fct($RB);\n    }\n\n    // modules\n    override registerModule(name: string, symbols: PyModule): void {\n        this.#module[name] = symbols;\n    }\n    override getModule(name: string): PyModule {\n        return this.#module[name];\n    } \n\n    // builtins\n    override registerBuiltins(symbols: PyModule): void {\n        for(let name in symbols)\n            this.registerBuiltin(name, symbols[name]);\n    }\n    override registerBuiltin(name: string, value: any): void {\n        this.#builtins[name] = value;\n\n        // @ts-ignore\n        globalThis[name] = value;\n    }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import Runner from \"@RBrython/rbry/runners/RBrythonGlobalRunner\";\n\nconst runner = new Runner();\n\nrunner.registerModule(\"JS\", globalThis);\n\nconst builtins = [\n    require(\"!!raw-loader!@RBrython/rbry/corelib-aot/bool.js\").default,\n    require(\"!!raw-loader!@RBrython/rbry/corelib-aot/float.js\").default,\n    require(\"!!raw-loader!@RBrython/rbry/corelib-aot/int.js\").default,\n    require(\"!!raw-loader!@RBrython/rbry/corelib-aot/str.js\").default,\n    require(\"!!raw-loader!@RBrython/rbry/corelib-aot/mfct.js\").default\n]\n\nfor(let builtin of builtins)\n    runner.registerBuiltins( runner.loadAsFunction( builtin ) );\n\nexport default runner;"],"names":["Runner","mapper","getClass","o","typename","type","constructor","lit_class","globalThis","undefined","Error","NotImplemented","Symbol","NI","b","defaults","eq","this","add","sub","mul","truediv","floordiv","mod","pow","and","or","xor","lshift","rshift","radd","rsub","rmul","rtruediv","rfloordiv","rmod","rpow","rand","ror","rxor","rlshift","rrshift","KW","IGNORE_ARG","_tmp","$RB","op","a","ka","console","warn","fct","prototype","call","slice","result","kb","uop","args","length","__call__","__new__","Object","getOwnPropertyDescriptors","writable","mcall","name","assert","cond","msg","attr","setattr","obj","key","value","getKW","setKW","tmp","saveTmp","v","withTmp","getModule","async","module","modules","__BRYTHON__","imported","pyobj2jsob","getModuleSync","abs","range","beg","end","inc","i","Exception","IVALUE","__JS_SET_IVALUE__","self","__JS_GET_IVALUE__","RBrythonGlobalRunner","run","jscode","runFunction","loadAsFunction","runSync","runSyncFunction","loadAsSyncFunction","eval","registerModule","symbols","registerBuiltins","registerBuiltin","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","__webpack_modules__","d","definition","defineProperty","enumerable","get","prop","hasOwnProperty","runner","builtins","require","builtin"],"sourceRoot":""}