{"version":3,"file":"Editor/index.js","mappings":"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","sources":["webpack://rbrython/./src/rbry/corelib/mfct.py","webpack://rbrython/./src/rbry/corelib/bool.py","webpack://rbrython/./src/rbry/runlib/interface/attr.ts","webpack://rbrython/./src/rbry/corelib/int.py","webpack://rbrython/./src/rbry/corelib/str.py","webpack://rbrython/./src/rbry/runners/interface.ts","webpack://rbrython/./src/pages/Editor/utils/BenchRunner.ts","webpack://rbrython/./src/pages/Editor/utils/printBenchStats.ts","webpack://rbrython/./src/rbry/corelib/float.py","webpack://rbrython/./src/rbry/runlib/helpers/getClass.ts","webpack://rbrython/./src/rbry/runlib/interface/setattr.ts","webpack://rbrython/./src/pages/Editor/index.html","webpack://rbrython/./src/rbry/runlib/interface/op.ts","webpack://rbrython/./src/rbry/runlib/interface/assert.ts","webpack://rbrython/./src/tests/py/kernel/match/classes.py","webpack://rbrython/./src/tests/py/core/float/op.py","webpack://rbrython/./src/rbry/runlib/helpers/isClass.ts","webpack://rbrython/./src/rbry/runlib/interface/call.ts","webpack://rbrython/./src/tests/py/core/int/op.py","webpack://rbrython/./src/rbry/runlib/tmp_corelib/type.ts","webpack://rbrython/./src/tests/index.ts","webpack://rbrython/./src/rbry/parser/index.ts","webpack://rbrython/./src/rbry/runners/BrythonGlobalRunner.ts","webpack://rbrython/./src/rbry/engines/interface.ts","webpack://rbrython/./src/rbry/targets/function.ts","webpack://rbrython/./src/rbry/engines/Base/index.ts","webpack://rbrython/./src/rbry/emitter/handlers/index.ts","webpack://rbrython/./src/rbry/ast/index.ts","webpack://rbrython/./src/rbry/emitter/node2js.ts","webpack://rbrython/./src/rbry/emitter/handlers/Body.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/BinOp.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/Call.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/Compare.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/UnaryOp.ts","webpack://rbrython/./src/rbry/emitter/handlers/list.ts","webpack://rbrython/./src/rbry/emitter/handlers/definitions/ClassDef.ts","webpack://rbrython/./src/rbry/emitter/handlers/definitions/FunctionDef.ts","webpack://rbrython/./src/rbry/ast/types/index.ts","webpack://rbrython/./src/rbry/emitter/handlers/definitions/Lambda.ts","webpack://rbrython/./src/rbry/emitter/handlers/definitions/Arguments.ts","webpack://rbrython/./src/rbry/emitter/handlers/keywords/Assert.ts","webpack://rbrython/./src/rbry/emitter/handlers/keywords/Pass.ts","webpack://rbrython/./src/rbry/emitter/handlers/keywords/Return.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/Assign.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/Attribute.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/AugAssign.ts","webpack://rbrython/./src/rbry/emitter/handlers/vars/Constant.ts","webpack://rbrython/./src/rbry/emitter/handlers/vars/Expr.ts","webpack://rbrython/./src/rbry/emitter/handlers/vars/Name.ts","webpack://rbrython/./src/rbry/emitter/handlers/vars/JoinedStr.ts","webpack://rbrython/./src/rbry/emitter/handlers/controlflows/If.ts","webpack://rbrython/./src/rbry/emitter/handlers/controlflows/While.ts","webpack://rbrython/./src/rbry/emitter/handlers/controlflows/For.ts","webpack://rbrython/./src/rbry/emitter/handlers/controlflows/Try.ts","webpack://rbrython/./src/rbry/emitter/handlers/controlflows/Match.ts","webpack://rbrython/./src/rbry/emitter/handlers/keywords/Continue.ts","webpack://rbrython/./src/rbry/emitter/handlers/keywords/Break.ts","webpack://rbrython/./src/rbry/emitter/handlers/keywords/Raise.ts","webpack://rbrython/./src/rbry/emitter/handlers/imports/ImportFrom.ts","webpack://rbrython/./src/rbry/emitter/handlers/imports/Import.ts","webpack://rbrython/./src/rbry/emitter/handlers/operators/BoolOp.ts","webpack://rbrython/./src/rbry/emitter/index.ts","webpack://rbrython/./src/rbry/targets/raw.ts","webpack://rbrython/./src/rbry/engines/Brython/index.ts","webpack://rbrython/./src/rbry/macros/__JS_OP__.ts","webpack://rbrython/./src/rbry/macros/__JS_RUN__.ts","webpack://rbrython/./src/rbry/macros/__JS_WRITE__.ts","webpack://rbrython/./src/rbry/macros/__JS_LOG__.ts","webpack://rbrython/./src/rbry/macros/__JS_AS_STRING__.ts","webpack://rbrython/./src/rbry/macros/__JS_AS_NUMBER__.ts","webpack://rbrython/./src/rbry/engines/index.ts","webpack://rbrython/./src/rbry/engines/RBrython/index.ts","webpack://rbrython/./src/pages/Editor/utils/engine.ts","webpack://rbrython/./src/rbry/runlib/interface/getModule.ts","webpack://rbrython/./src/rbry/runlib/index.ts","webpack://rbrython/./src/rbry/runlib/interface/mcall.ts","webpack://rbrython/./src/rbry/runlib/interface/uop.ts","webpack://rbrython/./src/rbry/runners/RBrythonGlobalRunner.ts","webpack://rbrython/./src/pages/Editor/index.ts","webpack://rbrython/./src/rbry/runlib/interface/KW.ts"],"sourcesContent":["export default \"#BUG\\n#def abs(o: float|int, /) -> float|int:\\n#    return o.__abs__()\";","export default \"from RBM import __JS_OP__, boolean\\n\\nclass bool(boolean): # type: ignore (bool is Final)\\n    def __eq__(self, o: object, /) -> bool:\\n        return __JS_OP__(self, \\\"==\\\", o)\";","export default function attr(o: any, attr: string) {\n    if( ! (attr in o) )\n        return o.constructor[attr];\n    return o[attr];\n}","export default \"from types import NotImplementedType\\nfrom RBM import __JS_AS_NUMBER__, __JS_OP__, bigint\\n\\nclass int(bigint):\\n\\n    def __new__(cls, o: object, base: int, /) -> int:\\n        if type(o) == str:\\n            return __JS_RUN__( # type: ignore\\n                '''\\n                    (x, base) => {\\n                        if( base !== 16)\\n                            return BigInt(x);\\n                        \\n                        let result = 0n;\\n                        for(let i = 2; i < x.length; ++i)\\n                            result = result << 4n + BigInt( parseInt(this.slice(i, i+8), 16) );\\n                        return result;\\n                    }\\n                ''', o, base) # type: ignore\\n        return type(o).__int__(o) # type: ignore\\n    \\n    def __eq__(self, o: object, /) -> bool:\\n        return __JS_OP__(self, \\\"==\\\", o)\\n\\n\\n    def __add__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"+\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __radd__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(o, \\\"+\\\", self)\\n            case _      : return NotImplemented\\n    \\n\\n    def __sub__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"-\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rsub__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(o, \\\"-\\\", self)\\n            case _      : return NotImplemented\\n    \\n    def __mul__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"*\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rmul__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(o, \\\"*\\\", self)\\n            case _      : return NotImplemented\\n\\n    def __pow__(self, o: object, mod: int|None = None, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"**\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rpow__(self, o: object, mod: int|None = None, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(o, \\\"**\\\", self)\\n            case _      : return NotImplemented\\n\\n    def __div__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(self),\\n                                           \\\"/\\\",\\n                                           __JS_AS_NUMBER__(o))\\n            case _      : return NotImplemented\\n    \\n    def __rdiv__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o),\\n                                           \\\"*\\\",\\n                                           __JS_AS_NUMBER__(self) )\\n            case _      : return NotImplemented\\n\\n    def __mod__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"%\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rmod__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"%\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __or__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"|\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __ror__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"|\\\", o)\\n            case _      : return NotImplemented\\n\\n    def __and__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"&\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rand__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"&\\\", o)\\n            case _      : return NotImplemented\\n        \\n    def __xor__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"^\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rxor__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"^\\\", o)\\n            case _      : return NotImplemented\\n\\n    def __lshift__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"<<\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rlshift__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\"<<\\\", o)\\n            case _      : return NotImplemented\\n\\n    def __rshift__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\">>\\\", o)\\n            case _      : return NotImplemented\\n    \\n    def __rrshift__(self, o: object, /) -> NotImplementedType|int:\\n        match o:\\n            case int  (): return __JS_OP__(self, \\\">>\\\", o)\\n            case _      : return NotImplemented\\n    \\n    ### unary operators ###\\n    def __invert__(self, /) -> int:\\n        return __JS_OP__(\\\"~\\\", self)\\n\\n    def __neg__(self, /) -> int:\\n        return __JS_OP__(\\\"-\\\", self)\\n    \\n    def __abs__(self, /) -> int:\\n         return __JS_RUN__(\\\"x => x < 0n ? -x : x\\\", self) # type: ignore\";","export default \"from types import NotImplementedType\\nfrom RBM import __JS_OP__, string\\n\\nclass str(string):\\n    def __new__(cls, o: object, /) -> str:\\n        return __JS_AS_STRING__(o) # type: ignore\\n        #return type(o).__str__(o) # type: ignore\\n    \\n    def __eq__(self, o: object, /) -> bool:\\n        return __JS_OP__(self, \\\"==\\\", o)\\n\\n    def __mul__(self, o: object, /) -> NotImplementedType|str:\\n        match o:\\n            case int  (): return __JS_WRITE__(\\\"self.repeat(Number(b))\\\") # type: ignore\\n            case _      : return NotImplemented\\n    \\n    def __rmul__(self, o: object, /) -> NotImplementedType|str:\\n        match o:\\n            case int  (): return __JS_WRITE__(\\\"self.repeat(Number(b))\\\") # type: ignore\\n            case _      : return NotImplemented\";","export type PyModule = Record<string, any>;\n\nexport default abstract class Runner {\n    \n    abstract run(jscode: string): PyModule;\n\n    abstract registerBuiltins(symbols: PyModule): void;\n    abstract registerBuiltin(name: string, value: any): void;\n\n    abstract registerModule(name: string, symbols: PyModule): void;\n    abstract      getModule(name: string): PyModule;\n\n    // low level\n    abstract loadAsFunction(jscode: string): (runlib: any) => PyModule;\n    abstract runFunction(fct: (runlib: any) => PyModule): PyModule;\n}","// initial data\n// add steps\n// get result\n// get metrics...\n\nimport Engine from \"@RBrython/rbry/engines/interface\";\n\nexport type BenchStats   = {\n    steps : {name: string, time: number}[];\n    ctx   : Record<string, any>\n    errors: Error[],\n    stats : Record<string, number>\n}\nexport type BenchResults = Record<string, BenchStats>;\n\nexport default class BenchRunner {\n\n    readonly steps  : {name: string, fct: (engine: Engine, context: Record<string, any>) => void}[] = [];\n    readonly engines: {name: string, engine: Engine}[] = [];\n    readonly   stats: {name: string, fct: (ctx: Record<string, any>) => number}[] = [];\n\n    addStat(name: string, fct: (ctx: Record<string, any>) => number) {\n        this.stats.push({name, fct});\n    }\n\n    addEngine(name: string, engine: Engine) {\n        this.engines.push({name, engine});\n        return this;\n    }\n    addStep(name: string, fct: (engine: Engine, context: Record<string, any>) => void) {\n        this.steps.push({name, fct});\n        return this;\n    }\n\n    #results: BenchResults | null = null;\n    resetStats() {\n        this.#results = {};\n        for(let r = 0; r < this.engines.length; ++r) {\n            this.#results[this.engines[r].name] = {\n                steps : new Array(this.steps.length),\n                ctx   : {},\n                errors: [],\n                stats : {}\n            };\n            for(let i = 0; i < this.steps.length; ++i)\n                this.#results[this.engines[r].name].steps[i] = {\n                    name: this.steps[i].name,\n                    time: 0\n                }\n            for(let i = 0; i < this.stats.length; ++i)\n                this.#results[this.engines[r].name].stats[this.stats[i].name]\n                    = 0;\n        }\n    }\n    getStats() {\n        return this.#results!;\n    }\n\n    bench(ctx: Record<string, any>) {\n\n        if( this.#results === null ) {\n            this.resetStats();\n        }\n        //TODO tokenize (stats).\n        //TODO print\n\n        const results = this.#results!;\n\n        for(let r = 0; r < this.engines.length; ++r) {\n            const engine = this.engines[r].engine;\n            const result = results[this.engines[r].name];\n            const context = result.ctx = {...ctx};\n\n            try {\n\n                for(let i = 0; i < this.steps.length; ++i) {\n\n                    const f = this.steps[i].fct;\n\n                    const beg = performance.now();\n                    f(engine, context);\n                    const end = performance.now();\n                    \n                    result.steps[i].time += end - beg;\n                }\n\n                for(let i = 0; i < this.stats.length; ++i) {\n                    result.stats[this.stats[i].name] += this.stats[i].fct(context);\n                }\n\n            } catch(e: unknown) {\n                result.errors.push( e as Error );\n            }\n        }\n    }\n}","import { BenchStats } from \"./BenchRunner\";\n\nfunction tformat(time: number, unit: string) {\n    return time.toFixed(3).padStart(7) + unit;\n}\n\nfunction tdiff(a: number, b: number) {\n\n    const c = a/b;\n\n    if( c === 1)\n        return \"   =   \";\n\n    if( c > 1 )\n        return \"x\" + c.toFixed(2).padStart(6);\n\n    return \"-\" + (-(100*a/b - 100)).toFixed(2).padStart(5) + \"%\";\n}\n\nexport default function printBenchStats(stats: BenchStats, base: BenchStats) {\n    \n    let report = \"\";\n\n    /*\n    const nb_lines    = results.total_lines;\n    const nb_excluded = results.nb_excluded_lines;\n    const nb_done     = nb_lines - nb_excluded;\n\n//    report += \"Status         : SUCCESS\\n\";\n    report += `Tested         : ${nb_done}/${nb_lines} (${(nb_done/nb_lines*100).toFixed(2)}%)\\n`;*/\n\n    const passed = stats.stats.asserts_count - stats.stats.asserts_fail;\n    let passed_rate = passed / stats.stats.asserts_count;\n    if( stats.stats.asserts_count === 0)\n        passed_rate = 1;\n\n    const nb_tokens = stats.stats.nbTokens;\n    report += `Asserts: ${passed}/${stats.stats.asserts_count} (${+(passed_rate*100)}%)\\n`\n    report += `Py code: ${nb_tokens} tokens (${stats.stats.nbFiles} file)\\n`;\n    \n    report += \"JS code: \" + tdiff(stats.ctx.jscode?.length,\n                                  base.ctx.jscode?.length) + \"\\n\";\n    report += \"\\nTimes:\\n\"\n\n\n    const tcoef = 100_000 / nb_tokens / 1000;\n\n    for(let i = 0; i < stats.steps.length; ++i) {\n\n        const name = stats.steps[i].name;\n        const time = stats.steps[i].time;\n        const cmp  =  base.steps[i].time;\n\n        report += `- ${name.padEnd(7)}\\t`\n                    + tformat(time * tcoef, \"s\")\n                    + \" [\"\n                    + tdiff(time, cmp)\n                    + \"] \"\n                    + tformat(time, \"ms\")\n                    + \"\\n\";\n    }\n\n    return report;\n}","export default \"from types import NotImplementedType\\nfrom RBM import __JS_OP__, __JS_AS_NUMBER__, __JS_WRITE__, number\\n\\nclass float(number):\\n    def __new__(cls, o: object, /) -> float:\\n        if type(o) is str:\\n            if o == \\\"infinity\\\" or o == \\\"inf\\\":\\n                return __JS_WRITE__(\\\"Number.POSITIVE_INFINITY\\\") # pyright: ignore[reportReturnType]\\n            if o == \\\"-infinity\\\" or o == \\\"-inf\\\":\\n                return __JS_WRITE__(\\\"Number.NEGATIVE_INFINITY\\\") # pyright: ignore[reportReturnType]\\n            return __JS_AS_NUMBER__(o)\\n        return type(o).__float__(o) # type: ignore\\n    \\n    def __eq__(self, o: object, /) -> bool:\\n        return __JS_OP__(self, \\\"==\\\", o)    \\n\\n    def __add__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(self, \\\"+\\\", o)\\n            case int  (): return __JS_OP__(self, \\\"+\\\", __JS_AS_NUMBER__(o))\\n            case _      : return NotImplemented\\n\\n    def __radd__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(o                  , \\\"+\\\", self)\\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), \\\"+\\\", self)\\n            case _      : return NotImplemented\\n\\n    def __sub__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(self, \\\"-\\\", o)\\n            case int  (): return __JS_OP__(self, \\\"-\\\", __JS_AS_NUMBER__(o))\\n            case _      : return NotImplemented\\n\\n    def __rsub__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(o                  , \\\"-\\\", self)\\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), \\\"-\\\", self)\\n            case _      : return NotImplemented\\n\\n    def __mul__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(self, \\\"*\\\", o)\\n            case int  (): return __JS_OP__(self, \\\"*\\\", __JS_AS_NUMBER__(o))\\n            case _      : return NotImplemented\\n\\n    def __rmul__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(o                  , \\\"*\\\", self)\\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), \\\"*\\\", self)\\n            case _      : return NotImplemented\\n\\n    def __div__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(self, \\\"/\\\", o)\\n            case int  (): return __JS_OP__(self, \\\"/\\\", __JS_AS_NUMBER__(o))\\n            case _      : return NotImplemented\\n\\n    def __rdiv__(self, o: object, /) -> NotImplementedType|float:\\n        match o:\\n            case float(): return __JS_OP__(o                  , \\\"/\\\", self)\\n            case int  (): return __JS_OP__(__JS_AS_NUMBER__(o), \\\"/\\\", self)\\n            case _      : return NotImplemented\\n\\n    ### unary operators ###\\n\\n    def __neg__(self, /) -> float:\\n        return __JS_OP__(\\\"-\\\", self)\\n    \\n    def __int__(self, /) -> int:\\n        return __JS_RUN__('(x) => Math.trunc(x)', self) # type: ignore\\n    \\n    def __abs__(self, /) -> int:\\n         return __JS_RUN__('(x) => Math.abs(x)', self) # type: ignore\";","import { type } from \"../tmp_corelib/type\";\n\nconst mapper = {\n    \"bigint\" : \"int\",\n    \"number\" : \"float\",\n    \"string\" : \"str\",\n    \"boolean\": \"bool\"\n}\n\nexport function getClass(o: unknown) {\n\n    const typename = typeof o;\n\n    if( typename === \"function\" ) {\n        //TODO: is class ? is something else ?\n        return type;\n    }\n\n    if( typename === \"object\" ) {\n        // @ts-ignore;\n        return o.constructor;\n    }\n\n    // @ts-ignore\n    const lit_class = globalThis[mapper[typename]];\n    if( lit_class !== undefined)\n        return lit_class;\n\n    throw new Error(`JS type ${typename} not implemented yet`);\n}","export default function setattr(obj: object, key: string, value:unknown) {\n    // @ts-ignore\n    return obj[key] = value;\n}","export default __webpack_public_path__ + \"Editor/index.html\";","import { getClass } from \"../helpers/getClass\";\n\n// @ts-ignore\nconst NotImplemented = globalThis.NotImplemented = Symbol();\n\nexport default function op(a: unknown, op: string, b: unknown) {\n    const ka = getClass(a);\n\n    if( ka === undefined ) {\n        console.warn(a, op);\n        throw new Error(\"?\")\n    }\n\n    let fct = ka.prototype[`__${op}__`];\n\n    if( fct === undefined ) {\n        if( op === \"ne\" )\n            return ! ka.prototype[\"__eq__\"].call(a, b);\n        if( op[0] === \"i\")\n            fct = ka.prototype[`__${op.slice(1)}__`];\n        if( fct === undefined)\n            fct = defaults[op as keyof typeof defaults];\n    }\n    \n    let result = fct.call(a, b);\n\n    if( result === NotImplemented) {\n\n        const kb = getClass(b);\n        if( kb === undefined ) {\n            console.warn(b, \"r\" + op);\n            throw new Error(\"?\");\n        }\n\n        let fct = kb.prototype[`__r${op}__`];\n        result = fct.call(b, a);\n    }\n\n    return result;\n}\n\n//TODO: move to corelib ?\nconst defaults = {\n    eq: function(b: unknown) { return this == b }\n}","export default function assert(cond: boolean) {\n    if( ! cond )\n        throw new Error(`Assertion failed`);\n}","export default \"def test(o: object, /):\\n    match o:\\n        case bool (): return \\\"bool\\\"\\n        case int  (): return \\\"int\\\"\\n        case float(): return \\\"float\\\"\\n        case _      : return \\\"unknown\\\"\\n\\nassert test(1)    == \\\"int\\\"\\nassert test(1.)   == \\\"float\\\"\\nassert test(True) == \\\"bool\\\"\";","export default \"assert 3 * 3.75 / 1.5 == 7.5\\nassert 7.0 / 2 == 3.5\";","export default function isClass(o: unknown) {\n    // from https://stackoverflow.com/questions/526559/testing-if-something-is-a-class-in-javascript\n    return Object.getOwnPropertyDescriptors(o)?.prototype?.writable === false;\n}\n// + https://github.com/brython-dev/brython/issues/2513","import { getClass } from \"../helpers/getClass\";\nimport isClass from \"../helpers/isClass\";\nimport { IGNORE_ARG } from \"./KW\";\n\nexport default function call(a: (...args:unknown[]) => unknown, ...args: unknown[]) {\n\n    if( args[args.length-1] === IGNORE_ARG)\n        args = args.slice(0,-1);\n\n    // @ts-ignore\n    let fct = a.__call__\n\n    if( fct === undefined ) {\n        fct = a;\n\n        // h4cky\n        if( fct.prototype?.__new__ !== undefined ) {\n            const b = getClass(fct).prototype.__call__;\n            if( b !== undefined) {\n                return b.call(fct, ...args);\n            }\n        }\n\n        if( isClass(fct) ) // only for JS classes now...\n            return new fct(...args);\n    }\n\n    return fct(...args);\n}\n","export default \"assert 2 + 2 == 4\\nassert (50 - 5 * 6) / 4 == 5.0\\nassert 8 / 5 == 1.6\\n#assert 7 // 3 == 2\\n#assert 7 // -3 == -3\";","export class type {\n    //TODO...\n    __call__(...args: any[]) {\n\n        console.warn(\"really called\");\n\n        // @ts-ignore\n        const factory = this.prototype.__new__;\n        const self = factory !== undefined\n                        ? factory.call(this, ...args)\n                        // @ts-ignore\n                        : new this(...args);\n        // @ts-ignore\n        const init = this.prototype.__init__;\n        if( init !== undefined)\n            init.call(self, ...args);\n        \n        return self\n    }\n    __eq__(b: unknown) {\n        return this == b;\n    }\n}","const test_suite = {\n    \"kernel/match/classes\": require(\"!!raw-loader!./py/kernel/match/classes.py\").default,\n    \"core/int/op\"    : require(\"!!raw-loader!./py/core/int/op.py\").default,\n    \"core/float/op\": require(\"!!raw-loader!./py/core/float/op.py\").default,\n}\n\nexport default test_suite;","import { ParsedCode } from \"../ast/types\";\n\nexport default function parse(pycode: string, filename: string): ParsedCode {\n    \n    const parser = new $B.Parser(pycode, filename, 'file');\n\n    const ast   = $B._PyPegen.run_parser(parser);\n    const future = $B.future_features(ast, filename)\n    var symtable = $B._PySymtable_Build(ast, filename, future);\n\n    return {\n        filename,\n        pycode,\n        ast,\n        symtable,\n    }\n}","import Runner, { PyModule } from \"./interface\";\n\nexport default class RBrythonGlobalRunner extends Runner {\n\n    override run(jscode: string) {\n        return this.runFunction( this.loadAsFunction(jscode) );\n    }\n\n    override loadAsFunction(jscode: string): () => PyModule {\n        $B.imported[\"_\"] = {};\n        return Function(\"'use strict';\" + jscode) as () => PyModule;\n    }\n    override runFunction( fct: (runlib: any) => PyModule ) {\n        // @ts-ignore\n        return fct();\n    }\n\n    override registerBuiltins(symbols: PyModule): void {\n        for(let name in symbols)\n            this.registerBuiltin(name, symbols[name]);\n    }\n    override registerBuiltin(name: string, value: any): void {\n        $B.builtins[name] = $B.jsobj2pyobj(value);\n    }\n    override registerModule(name: string, symbols: PyModule): void {\n        $B.imported[name] = $B.jsobj2pyobj( symbols );\n    }\n    override getModule(name: string): PyModule {\n        return $B.imported[name];\n    }\n}","import { ParsedCode } from \"../ast/types\";\nimport { EmitterOptions } from \"../emitter\";\nimport { Macro } from \"../emitter/handlers/operators/Call\";\nimport { PyModule } from \"../runners/interface\";\n\nexport default abstract class Engine {\n    abstract run(pycode: string, opts?: EmitterOptions): PyModule;\n\n    abstract registerModule(name: string, symbols: string|PyModule): void;\n    abstract      getModule(name: string): PyModule;\n\n    abstract registerBuiltins(symbols: string|PyModule): void;\n    abstract registerBuiltin(name: string, value: any): void;\n    \n    abstract registerMacros(macros: Record<string, Macro>):void;\n    abstract registerMacro(name: string, fct: Macro): void;\n\n    // low level\n    abstract parse(pycode: string): ParsedCode;\n    abstract emit (parsed: ParsedCode, opts?: Partial<EmitterOptions>): string;\n    \n    abstract loadAsFunction(jscode: string): (runlib: any) => PyModule;\n    abstract runFunction(fct: (runlib: any) => PyModule): PyModule;\n}","import { JSCode } from \"./interface\";\n\nexport function FunctionTarget(jscode: JSCode) {\n    return `\"use strict\";${jscode.jscode}return {${jscode.exported.join(\", \")}};`;\n}","import Engine from \"../interface\";\nimport { ParsedCode } from \"@RBrython/rbry/ast/types\";\nimport Runner, { PyModule } from \"@RBrython/rbry/runners/interface\";\nimport parse from \"@RBrython/rbry/parser\";\nimport {Emitter, EmitterOptions} from \"@RBrython/rbry/emitter\";\nimport { Macro } from \"@RBrython/rbry/emitter/handlers/operators/Call\";\nimport { FunctionTarget } from \"@RBrython/rbry/targets/function\";\n\ntype Parser  = typeof parse;\n\nexport default class BaseEngine extends Engine {\n\n    protected readonly parser;\n    protected readonly emitter;\n    protected readonly runner;\n\n    constructor(parser: Parser, emitter: Emitter, runner: Runner) {\n        super();\n\n        this.parser  = parser;\n        this.emitter = emitter;\n        this.runner  = runner;\n    }\n\n    override run(pycode: string, opts?: Omit<EmitterOptions, \"target\">): PyModule {\n\n        return this.runner.run(this.emit(this.parse(pycode), {\n            ...opts,\n            target: FunctionTarget\n        }));\n    }\n\n    // modules\n    override registerModule(name: string, symbols: string | PyModule): void {\n        if( typeof symbols === \"string\")\n            symbols = this.run(symbols);\n        this.runner.registerModule(name, symbols);\n    }\n    override getModule(name: string): PyModule {\n        return this.runner.getModule(name);\n    }\n\n    // builtins\n    override registerBuiltins(symbols: string | PyModule): void {\n        if( typeof symbols === \"string\")\n            symbols = this.run(symbols);\n        this.runner.registerBuiltins(symbols);\n    }\n    override registerBuiltin(name: string, value: any): void {\n        this.runner.registerBuiltin(name, value);\n    }\n\n    override registerMacros(macros: Record<string, Macro>):void {\n        this.emitter.registerMacros(macros);\n\n    }\n    override registerMacro(name: string, fct: Macro): void {\n        this.emitter.registerMacro(name, fct);\n    }\n\n    // steps\n    override parse(pycode: string): ParsedCode {\n        return this.parser(pycode, \"_\");\n    }\n    override emit(parsed: ParsedCode, opts?: Partial<EmitterOptions>): string {\n        return this.emitter.emit(parsed, opts);\n    }\n    override loadAsFunction(jscode: string): (runlib: any) => PyModule {\n        return this.runner.loadAsFunction(jscode);\n    }\n    override runFunction(fct: (runlib: any) => PyModule): PyModule {\n        return this.runner.runFunction(fct);\n    }\n}","// list is filled in list.ts in order to prevent circular dependency.\n\nimport { ASTNode, SymTab } from \"../../ast/types\";\n\nexport type Handler = (    node: ASTNode,\n                        symtab?: SymTab,\n                        ...args: unknown[]) => string;\n\nconst Handlers: Record<string, Handler> = {};\n\nexport default Handlers;","import { ASTNode, OperatorNode } from \"./types\";\n\nexport function nodeType(node: ASTNode): string {\n    // @ts-ignore\n    return node.constructor.$name;\n}\n\nexport function getOp(op: OperatorNode): string {\n    // @ts-ignore\n    return op.constructor.$name\n}","import { nodeType } from \"../ast\";\nimport { ASTNode, SymTab } from \"../ast/types\";\nimport Handlers from \"./handlers\";\n\nexport function node2js(node: ASTNode, symtab?: SymTab, ...args: unknown[]): string {\n\n    const handler = Handlers[nodeType(node) as keyof typeof Handlers];\n\n    if( handler === undefined) {\n        console.warn(node);\n        throw new Error(`Node type ${nodeType(node)} is unknown`);\n    }\n\n    return handler(node, symtab, ...args);\n}\n","import { BodyNode, SymTab } from \"../../ast/types\";\nimport { node2js } from \"../node2js\";\n\nexport default function(body: BodyNode, symtab: SymTab) {\n\n    let res = \"\";\n    for(let i = 0; i < body.length; ++i)\n        res += node2js(body[i], symtab) + \";\\n\";\n\n    return res;\n}","import { getOp } from \"../../../ast/\";\nimport { BinaryOpNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function(node: BinaryOpNode) {\n    const a = node.left;\n    const b = node.right;\n    const op = getOp(node.op) as keyof typeof binops;\n\n    const opname = binops[op];\n    if( opname === undefined) \n        throw new Error(`BinOp ${op} not impl`);\n\n    return `$RB.op(${node2js(a)}, \"${opname}\", ${node2js(b)})`;\n}\n\nexport const binops = {\n    Add : \"add\",\n    Sub : \"sub\",\n    Mult: \"mul\",\n    Div : \"div\",\n    Pow : \"pow\",\n    Mod : \"mod\",\n    // bits\n    BitOr: \"or\",\n    BitAnd: \"and\",\n    LShift: \"lshift\",\n    RShift: \"rshift\"\n}","import { node2js } from \"../../node2js\";\nimport { nodeType } from \"../../../ast\";\nimport { ASTNode, AttributeNode, CallNode } from \"../../../ast/types\";\n\nexport type Macro = (...args: ASTNode[]) => string;\nexport const macros: Record<string, Macro> = {};\n\nexport default function Call(node: CallNode) {\n    const f        = node.func;\n    const args     = node.args;\n    const keywords = node.keywords;\n\n    // @ts-ignore\n    if( f.id in macros)\n        // @ts-ignore\n        return macros[f.id]( ...node.args );\n\n    //TODO: args parsing...\n    let str = \"\";\n    for(let i = 0; i < args.length; ++i)\n        str += node2js(args[i]) + \", \";\n\n    if( keywords.length ) {\n        str += \"$RB.setKW({\";\n            for( let i = 0; i < keywords.length; ++i)\n                // @ts-ignore\n                str += `${keywords[i].arg}: ${node2js(keywords[i].value)},`;\n        str += \"})\";\n    }    \n\n    if( nodeType(f) === \"Attribute\") {\n        const m = f as AttributeNode;\n        return `$RB.mcall(${node2js(m.value)}, \"${m.attr}\", ${str} )`;\n    }\n\n    return `$RB.call(${node2js(f)}, ${str})`;\n}","import { CompareNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\nimport { getOp } from \"../../../ast/\";\n\nexport default function Compare(node: CompareNode) {\n\n    const a = node.left;\n    const op = getOp(node.ops[0]) as keyof typeof cmpops | \"Is\";\n    const b  = node.comparators[0];\n\n    if( op === 'Is' ) return `${node2js(a)} === ${node2js(b)}`;\n    \n    const opname = cmpops[op];\n    if( opname === undefined) {\n        console.warn(op);\n        throw new Error(`CmpOp ${op} not impl`);\n    }\n\n    return `$RB.op(${node2js(a)}, \"${opname}\", ${node2js(b)})`;\n}\n\nconst cmpops = {\n    Eq   : \"eq\",\n    NotEq: \"ne\"\n}\n","import { UnaryOpNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\nimport { getOp } from \"../../../ast/\";\n\nexport default function(node: UnaryOpNode) {\n\n    const a = node.operand;\n    const op = getOp(node.op) as keyof typeof uops;\n\n    const opname = uops[op];\n    if( opname === undefined) \n        throw new Error(`UnaryOp ${op} not impl`);\n\n    return `$RB.uop(\"${opname}\", ${node2js(a)})`;\n}\n\nconst uops = {\n    Invert: \"invert\",\n    USub: \"neg\",\n    // pos\n\n    // special:\n    Not: \"not\", // use __len__ or __bool__\n}","import Handlers, { Handler } from \"./index\";\n\nimport {default as ClassDef} from \"./definitions/ClassDef\";\nHandlers[\"ClassDef\"] = ClassDef as Handler;\n\nimport {default as FunctionDef} from \"./definitions/FunctionDef\";\nHandlers[\"FunctionDef\"] = FunctionDef as Handler;\n\nimport {default as Lambda} from \"./definitions/Lambda\";\nHandlers[\"Lambda\"] = Lambda as Handler;\n\nimport {default as Arguments} from \"./definitions/Arguments\";\nHandlers[\"arguments\"] = Arguments as Handler;\n\nimport {default as Assert} from \"./keywords/Assert\";\nHandlers[\"Assert\"] = Assert as Handler;\n\nimport {default as Pass} from \"./keywords/Pass\";\nHandlers[\"Pass\"] = Pass as Handler;\n\nimport {default as Return} from \"./keywords/Return\";\nHandlers[\"Return\"] = Return as Handler;\n\n\nimport {default as Assign} from \"./operators/Assign\";\nHandlers[\"Assign\"] = Assign as Handler;\n\nimport {default as Attribute} from \"./operators/Attribute\";\nHandlers[\"Attribute\"] = Attribute as Handler;\n\nimport {default as AugAssign} from \"./operators/AugAssign\";\nHandlers[\"AugAssign\"] = AugAssign as Handler;\n\nimport {default as BinOp} from \"./operators/BinOp\";\nHandlers[\"BinOp\"] = BinOp as Handler;\n\nimport {default as Call} from \"./operators/Call\";\nHandlers[\"Call\"] = Call as Handler;\n\nimport {default as Compare} from \"./operators/Compare\";\nHandlers[\"Compare\"] = Compare as Handler;\n\nimport {default as UnaryOp} from \"./operators/UnaryOp\";\nHandlers[\"UnaryOp\"] = UnaryOp as Handler;\n\nimport {default as Constant} from \"./vars/Constant\";\nHandlers[\"Constant\"] = Constant as Handler;\n\nimport {default as Expr} from \"./vars/Expr\";\nHandlers[\"Expr\"] = Expr as Handler;\n\nimport {default as Name} from \"./vars/Name\";\nHandlers[\"Name\"] = Name as Handler;\n\nimport {default as JoinedStr} from \"./vars/JoinedStr\";\nHandlers[\"JoinedStr\"] = JoinedStr as Handler;\n\nimport {default as If} from \"./controlflows/If\";\nHandlers[\"If\"] = If as Handler;\n\nimport {default as While} from \"./controlflows/While\";\nHandlers[\"While\"] = While as Handler;\n\nimport {default as For} from \"./controlflows/For\";\nHandlers[\"For\"] = For as Handler;\n\nimport {default as Try} from \"./controlflows/Try\";\nHandlers[\"Try\"] = Try as Handler;\n\nimport {default as Match} from \"./controlflows/Match\";\nHandlers[\"Match\"] = Match as Handler;\n\nimport {default as Continue} from \"./keywords/Continue\";\nHandlers[\"Continue\"] = Continue as Handler;\n\nimport {default as Break} from \"./keywords/Break\";\nHandlers[\"Break\"] = Break as Handler;\n\nimport {default as Raise} from \"./keywords/Raise\";\nHandlers[\"Raise\"] = Raise as Handler;\n\nimport {default as ImportFrom} from \"./imports/ImportFrom\";\nHandlers[\"ImportFrom\"] = ImportFrom as Handler;\n\nimport {default as Import} from \"./imports/Import\";\nHandlers[\"Import\"] = Import as Handler;\n\nimport {default as BoolOp} from \"./operators/BoolOp\";\nHandlers[\"BoolOp\"] = BoolOp as Handler;\n\n","import { node2js } from \"../../node2js\";\nimport { ClassDefNode, SymTab } from \"../../../ast/types\";\nimport Body from \"../Body\";\n\nexport default function ClassDef(node: ClassDefNode, symtab: SymTab) {\n\n    const name = node.name;\n    const body = node.body;\n\n    const csymtab = symtab.children.find( (e) => e.name === name)!;\n\n    // JS cstr\n    let str = `var ${name} = (() =>{\n        function ${name}() {\n            return Object.create(${name}.prototype);\n        }\n    `;\n\n    // inheritance\n\n    // @ts-ignore\n    const isH4ck = node.bases.length === 1 && [\"number\", \"bigint\", \"boolean\", \"string\"].includes(node.bases[0].id);\n\n    if( !isH4ck && node.bases.length >= 1) {\n        str += `${name}.prototype = Object.create(${node2js(node.bases[0])}.prototype);\\n`;\n    \n        for(let i = 1; i < node.bases.length; ++i) {\n\n            str += `Object.assign(${name}.prototype, ${node2js(node.bases[i])}.prototype);`;\n        }\n\n        str += `${name}.prototype.constructor = ${name};\\n`;\n    }\n\n    // body...\n    str += Body(body, csymtab);\n\n    str += `\n        return ${name};\n    })();\n    `;\n\n    return str;\n}","import Body from \"../Body\";\nimport { node2js } from \"../../node2js\";\nimport { CLASS, FunctionDefNode, SymTab } from \"../../../ast/types\";\n\nexport default function FunctionDef(node: FunctionDefNode, symtab: SymTab) {\n\n    const isMethod = symtab.type === CLASS;\n\n    const name = node.name;\n    const body = node.body;\n\n    const fsymtab = symtab.children.find( (e) => e.name === name)!;\n\n    let result = \"\";\n    if( symtab.type === CLASS )\n        result += `${symtab.name}.prototype.${name} = `;\n\n    for( let i = 0; i < node.decorator_list.length ; ++i )\n        result += `${node2js(node.decorator_list[i])}(`;\n\n    result += `function ${name}(`;\n\n    result += node2js(node.args, symtab, isMethod);\n\n    result += \"){\";\n\n    if( isMethod ) {\n        let selfname = \"\";\n        if( node.args.posonlyargs.length > 0)\n            selfname = node.args.posonlyargs[0].arg;\n        else\n            selfname = node.args.args[0].arg;\n        result += `const ${selfname} = this;`; //TODO: prefer var renaming...\n    }\n\n    result += `\n        ${Body(body, fsymtab)}\n    }`;\n\n    for( let i = 0; i < node.decorator_list.length ; ++i )\n        result += \")\";\n\n    return result;\n}","export const FUNCTION = 0;\nexport const CLASS    = 1;\nexport const BODY     = 1;\n\nexport type SymTab = {\n    name    : string;\n    children: SymTab[];\n    symbols : {\n        $strings: Record<string, number>\n    }\n    type: typeof FUNCTION|typeof CLASS|typeof BODY;\n};\n\nexport type ParsedCode = {\n    filename: string,\n    pycode  : string,\n    ast     : ModuleNode,\n    symtable: SymTab,\n};\n\nexport type ASTNode = {};\n\nexport type BodyNode = ASTNode[];\n\nexport type ModuleNode = {\n    body: BodyNode\n} & ASTNode;\n\nexport type ExprNode = {\n    value: ASTNode\n}\n\nexport type ConstantNode = {\n    value: number|string|boolean|{value: number|bigint}\n}\n\nexport type AssertNode = {\n    test: ASTNode\n}\n\nexport type OperatorNode = unknown; // better to shadow it...\n\nexport type UnaryOpNode = {\n    operand: ASTNode;\n    op     : OperatorNode; \n}\n\nexport type BinaryOpNode = {\n    left : ASTNode;\n    right: ASTNode;\n    op   : OperatorNode;\n}\n\nexport type CompareNode = {\n    left       : ASTNode;\n    ops        : OperatorNode[];\n    comparators: ASTNode[];\n}\n\nexport type NameNode = {\n    id: string;\n}\n\nexport type AssignNode = {\n    value  : ASTNode;\n    targets: ASTNode[];\n}\n\nexport type AugAssignNode = {\n    target : ASTNode;\n    value  : ASTNode;\n    op     : OperatorNode;\n}\n\n\nexport type ReturnNode = {\n    value  : ASTNode;\n}\n\nexport type PassNode = {}\n\nexport type AttributeNode = {\n    value: ASTNode;\n    attr : string;\n}\n\nexport type CallNode = {\n    func    : ASTNode\n    args    : ASTNode[],\n    keywords: ASTNode[]\n}\n\nexport type ClassDefNode = {\n    name: string;\n    body: BodyNode;\n    bases: ASTNode[];\n}\n\nexport type ArgsDefNode = {\n    posonlyargs: ArgDefNode[];\n    args       : ArgDefNode[];\n}\n\nexport type ArgDefNode = {\n    arg: string\n}\n\nexport type LambdaDefNode = {\n    args: ArgsDefNode;\n    body: BodyNode;\n}\n\nexport type FunctionDefNode = {\n    name: string;\n    posonlyargs: ASTNode[];\n    args: ArgsDefNode;\n    body: BodyNode;\n    decorator_list: ASTNode[]\n}\n\nexport type IfNode = {\n    test: ASTNode;\n    body: BodyNode;\n    orelse: ASTNode[];\n}\n\nexport type WhileNode = {\n    test: ASTNode;\n    body: BodyNode;\n    //TODO: orelse\n}\n\nexport type ForNode = {\n    target: ASTNode;\n    iter  : ASTNode;\n    body  : BodyNode;\n    //TODO: orelse\n}\n\nexport type RaiseNode = {\n    exc: ASTNode;\n}\n\nexport type TryNode = {\n    body: BodyNode;\n    handlers: ASTNode[];\n}\n\nexport type JoinedStrNode = {\n    values: ASTNode[]\n}","import { LambdaDefNode, SymTab } from \"@RBrython/rbry/ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function Lambda(node: LambdaDefNode, symtab: SymTab): string {\n    \n    const args = node2js(node.args, symtab);\n\n    return `(${args}) => { return ${node2js(node.body)}}`\n}","import { ArgsDefNode, SymTab } from \"@RBrython/rbry/ast/types\";\n\n//TODO: vararg + kw => dans le corps...\nexport default function Arguments(node: ArgsDefNode,\n                                symtab: SymTab,\n                              isMethod: boolean = false) {\n    \n    let result = \"\";\n\n    // if method => ignore first parameter...\n    let pos_offset = 0;\n    let arg_offset = 0;\n\n    if( isMethod ) {\n        if( node.posonlyargs.length)\n            ++pos_offset\n        else\n            ++arg_offset;\n    }\n\n    for(let i = pos_offset; i < node.posonlyargs.length; ++i)\n        result += `${node.posonlyargs[i].arg}, `;\n\n    for(let i = arg_offset; i < node.args.length; ++i)\n        result += `_${node.args[i].arg}, `;\n\n    if( node.args.length ) {\n        // kw...\n        result += \"{\";\n        for( let i = arg_offset ; i < node.args.length; ++i)\n            result += `${node.args[i].arg} = _${node.args[i].arg}, `;\n        result += \"} = $RB.getKW()\";\n    }\n\n    return result;\n}","import { MODE } from \"../..\";\nimport { AssertNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function Assert(node: AssertNode) {\n\n    // @ts-ignore\n    if( globalThis.mode === MODE.PROD )\n        return \"\";\n\n    return `$RB.assert(${node2js(node.test)})`;\n}","import { PassNode } from \"../../../ast/types\";\n\nexport default function Pass(node: PassNode) {\n    return \"\";\n}","import { ReturnNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function Return(node: ReturnNode) {\n    return `return ${ node2js(node.value) }`;\n}","import { nodeType } from \"@RBrython/rbry/ast\";\nimport { AssignNode, SymTab } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function Assign(node: AssignNode, symtab: SymTab) {\n\n    let res = \"\";\n\n    let prefix = \"var \";\n    const type = nodeType(node.targets[0]);\n    if( type === \"Attribute\" )\n        // @ts-ignore\n        return `$RB.setattr(${node2js(node.targets[0].value)}, \"${node.targets[0].attr}\", ${node2js(node.value)})`;\n\n    for(let i = 1; i < node.targets.length; ++i)\n        res += `${prefix}${node2js(node.targets[i])};`;\n\n    res += prefix + node2js(node.targets[0]) + \" = \";\n    for(let i = 1; i < node.targets.length; ++i)\n        res += node2js(node.targets[i]) + \" = \";\n\n    return res + node2js(node.value);\n}","import { AttributeNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function (node: AttributeNode) {\n    return `$RB.attr(${node2js(node.value)}, \"${node.attr}\")`;\n}","import { AugAssignNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\nimport { binops } from \"./BinOp\";\nimport { getOp } from \"../../../ast/\";\n\nexport default function AugAssign(node: AugAssignNode) {\n \n    const a  = node.target;\n    const op = getOp(node.op) as keyof typeof binops;\n    const b  = node.value;\n\n    const opname = binops[op];\n    if( opname === undefined) \n        throw new Error(`BinOp ${op} not impl`);\n\n    return `${node2js(a)} = $RB.op(${node2js(a)}, \"i${opname}\", ${node2js(b)})`;   \n}","import { ConstantNode } from \"../../../ast/types\";\n\nexport default function Constant(node: ConstantNode) {\n\n        const type = typeof node.value;\n\n        if( type === \"object\") {\n            // @ts-ignore\n            const qname = node.value.__class__.__qualname__\n            // @ts-ignore\n            const value: float|bigint = node.value.value;\n\n            if( qname === \"float\"   ) return `${value}`;\n            if( qname === \"int\"     ) return `${value}n`;\n            if( qname === \"NoneType\") return \"null\";\n            //if( qname === \"ellipsis\") return \"$RB.ellipsis\";\n        }\n        if( type === \"string\" ) return `\"${node.value}\"`;\n        if( type === \"number\" ) return `${node.value}n`; // bigint\n        if( type === \"boolean\") return `${node.value}`;\n\n        console.warn(node, type);\n        throw new Error(`Unknown Cste ${type}`);\n}","import { ExprNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function Expr(node: ExprNode) {\n    return node2js(node.value);\n}","import { NameNode } from \"../../../ast/types\";\n\nexport default function Name(node: NameNode) {\n\n    // h4ck\n    if( node.id === \"__debug__\")\n        // @ts-ignore\n        return `${globalThis.mode === MODE.DEBUG}`;\n\n    return node.id;\n}","import { nodeType } from \"../../../ast/\";\nimport { node2js } from \"../../node2js\";\nimport { JoinedStrNode } from \"../../../ast/types\";\n\nexport default function JoinedStr(node: JoinedStrNode) {\n\n    console.warn(node);\n\n    let res = \"`\";\n    for(let i = 0; i < node.values.length; ++i) {\n        const value = node.values[i];\n        const type  = nodeType(value);\n\n        if( type === \"Constant\")\n            // @ts-ignore\n            res += value.value;\n        else {\n            // @ts-ignore\n            res += `\\${${node2js(value.value)}}`;\n        }\n    }\n    res += \"`\";\n    return res;\n}","import { IfNode, SymTab } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\nimport Body from \"../Body\";\nimport { nodeType } from \"../../../ast/\";\n\nexport default function If(node: IfNode, symtab: SymTab) {\n\n    let str = `if( ${node2js(node.test)} ) {\n        ${ Body(node.body, symtab) }\n    }`;\n\n    for(let i = 0; i < node.orelse.length; ++i) {\n        const snode = node.orelse[i];\n        const type = nodeType(snode);\n\n        if( type === \"If\")\n            str += \"else \" + node2js(snode);\n        else\n            str += `else { ${node2js(snode)} }`;\n    }\n\n    return str;\n}","import { SymTab, WhileNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\nimport Body from \"../Body\";\n\nexport default function While(node: WhileNode, symtab: SymTab) {\n\n    return `while( ${node2js(node.test)} ) {\n        ${Body(node.body, symtab)}\n    }`;\n\n}","import { ForNode, SymTab } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\nimport Body from \"../Body\";\n\nexport default function For(node: ForNode, symtab: SymTab) {\n    return `for(${node2js(node.target)} of ${node2js(node.iter)}){\n        ${Body(node.body, symtab)}\n    }`;\n}","import { SymTab, TryNode } from \"../../../ast/types\";\nimport Body from \"../Body\";\n\nexport default function Try(node: TryNode, symtab: SymTab) {\n    //TODO...\n    return `try {\n        ${Body(node.body, symtab)}\n    } catch {\n        ${  // @ts-ignore\n            Body(node.handlers[0].body, symtab)\n        }\n    }`;\n}","import { ASTNode, SymTab } from \"@RBrython/rbry/ast/types\";\nimport { node2js } from \"../../node2js\";\nimport Body from \"../Body\";\n\nexport default function Match(node: ASTNode, symtab: SymTab) {\n\n    let result = \"{\";\n\n    // @ts-ignore\n    result += `const tname = type(${node2js(node.subject)}).name;`\n\n    // @ts-ignore\n    for(let i = 0; i < node.cases.length -1; ++i) {\n        if( i !== 0)\n            result += \"else \";\n        // @ts-ignore\n        result += `if( tname === \"${node.cases[i].pattern.cls.id}\") {\n            ${  // @ts-ignore\n                Body(node.cases[i].body, symtab)}\n        }`;\n    }\n    result += `else {\n            ${  // @ts-ignore\n                Body(node.cases[node.cases.length-1].body, symtab)}\n    }`;\n\n    result += \"}\";\n\n    return result;\n}","import { ASTNode } from \"../../../ast/types\";\n\nexport default function Continue(node: ASTNode) {\n    return \"continue;\"\n}","import { ASTNode } from \"../../../ast/types\";\n\nexport default function Break(node: ASTNode) {\n    return \"break;\"\n}","import { RaiseNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function Raise(node: RaiseNode) {\n    return `throw ${node2js(node.exc)};`;\n}","import { ASTNode } from \"../../../ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function ImportFrom(node: ASTNode) {\n\n    // @ts-ignore\n    const module = node.module;\n\n    if( module === \"RBM\" )\n        return \"\"; // Brython macros...\n\n    if( module === \"types\" || module === \"typing\")\n        return \"\"; // ignore for now\n    if( module === \"functools\") {\n        console.warn(\"Import not implemented yet\");\n        return \"\";\n    }\n    let res = \"const {\";\n\n    // @ts-ignore\n    for(let i = 0; i < node.names.length; ++i)\n        // @ts-ignore\n        res += `${node.names[i].name},`;\n\n    return res + `} = $RB.getModule(\"${module}\")`;\n}","import { ASTNode } from \"../../../ast/types\";\n\nexport default function Import(node: ASTNode) {\n\n    // @ts-ignore\n    const module = node.names[0].name;\n\n    if( module === \"RBM\" )\n        return \"\"; // Brython macros...\n\n    return `const ${module} = $RB.getModule(\"${module}\")`;\n}","import { getOp } from \"@RBrython/rbry/ast\";\nimport { ASTNode } from \"@RBrython/rbry/ast/types\";\nimport { node2js } from \"../../node2js\";\n\nexport default function BoolOp(node: ASTNode) {\n\n    // @ts-ignore\n    const op = getOp(node.op);\n\n    let jsop = \"\";\n    if( op === \"Or\")\n        jsop = \"||\";\n    if( op === \"And\")\n        jsop = \"&&\";\n\n    // @ts-ignore\n    return `${node2js(node.values[0])}${jsop}${node2js(node.values[1])}`;\n}","// quick h4ck (should move it).\nimport \"../runlib\";\nimport \"./handlers/list\"; // ensure Handlers are loaded.\n\nimport { ParsedCode } from \"../ast/types\";\nimport Body from \"./handlers/Body\";\nimport { Macro, macros } from \"./handlers/operators/Call\";\nimport { Target } from \"../targets/interface\";\nimport { RawTarget } from \"../targets/raw\";\n\nexport enum MODE {\n  DEBUG,\n  TEST,\n  PROD,\n}\n\nexport type EmitterOptions = {\n    mode  : MODE,\n    target: Target\n}\n\nconst EmitterDefaults: EmitterOptions = {\n    mode  : MODE.DEBUG,\n    target: RawTarget\n}\n\nexport abstract class Emitter {\n    abstract emit(parsed: ParsedCode, opts?: Partial<EmitterOptions>): string;\n\n    abstract registerMacros(macros: Record<string, Macro>):void;\n    abstract registerMacro(name: string, fct: Macro): void;\n}\n\nexport default class RBrythonEmitter extends Emitter {\n\n    protected readonly macros = macros;\n\n    registerMacros(macros: Record<string, Macro>) {\n        for(let name in macros)\n            this.macros[name] = macros[name];\n    }\n    registerMacro(name: string, fct: Macro) {\n        this.macros[name] = fct;\n    }\n\n    emit(parsed: ParsedCode, {\n                                mode   = EmitterDefaults.mode,\n                                target = EmitterDefaults.target\n                            }: Partial<EmitterOptions> = {}) {\n\n        // @ts-ignore\n        globalThis.mode = mode;\n\n        const bodyNode = parsed.ast.body;\n\n        const body    = Body(bodyNode, parsed.symtable);\n        const exported= this.extractExportedSymbols(parsed);\n\n        const jscode = body;\n\n        const output = {\n            name    : \"_\",\n            imported: [],\n            exported,\n            jscode,\n        }\n\n        return target(output);\n    }\n\n    private extractExportedSymbols(parsed: ParsedCode) {\n        \n        const symbols = parsed.symtable.symbols.$strings\n        return Object.keys(symbols)\n                     .filter( k => symbols[k] === 4098); // magic value\n    }\n}\n","import { JSCode } from \"./interface\";\n\nexport function RawTarget(jscode: JSCode) {\n    return jscode.jscode;\n}","import { ParsedCode } from \"../../ast/types\";\nimport parse from \"../../parser\";\nimport BrythonGlobalRunner from \"@RBrython/rbry/runners/BrythonGlobalRunner\";\nimport BaseEngine from \"../Base\";\nimport { Emitter } from \"@RBrython/rbry/emitter\";\nimport { Macro } from \"@RBrython/rbry/emitter/handlers/operators/Call\";\n\nclass BrythonEmitter extends Emitter {\n    emit(parsed: ParsedCode) {\n\n        let imported:any;\n        return $B.js_from_root({ast     : parsed.ast,\n                                symtable: parsed.symtable,\n                                filename: parsed.filename,\n                                src     : parsed.pycode,\n                                imported}).js\n    }\n\n    override registerMacros(macros: Record<string, Macro>) {\n        throw new Error(\"Not implemented\");\n    }\n    override registerMacro(name: string, fct: Macro) {\n        throw new Error(\"Not implemented\");\n    }\n}\n\nexport default function BrythonEngineFactory() {\n\n    const emitter = new BrythonEmitter();\n    const runner  = new BrythonGlobalRunner();\n    const engine  = new BaseEngine(parse, emitter, runner);\n\n    engine.registerModule(\"JS\", globalThis);\n    \n    // builtins are already included in Brython.\n\n    return engine;\n}","import { ASTNode } from \"../ast/types\";\nimport { node2js } from \"../emitter/node2js\";\n\nexport default function __JS_OP__(...args: ASTNode[]) {\n    \n    if(args.length === 2) // unary op\n        // @ts-ignore\n        return `${args[0].value}${node2js(args[1])}`;\n    \n    // binary op\n    // @ts-ignore\n    return `${node2js(args[0])} ${args[1].value} ${node2js(args[2])}`;\n}","import { ASTNode } from \"../ast/types\";\nimport { node2js } from \"../emitter/node2js\";\n\nexport default function __JS_RUN__(...args: ASTNode[]) {\n    // @ts-ignore\n    return `(${unescape(args[0].value)})(${args.slice(1).map(e=>node2js(e)).join(\",\")})`;\n}\n\nfunction unescape(str: string) {\n    str = str.replaceAll(\"\\\\n\\\\\", \"\\n\");\n    return str;\n}","import { ASTNode } from \"../ast/types\";\n\nexport default function __JS_WRITE__(code: ASTNode) {\n    // @ts-ignore\n    return code.value; //TODO: improve\n}","import { ASTNode } from \"../ast/types\";\nimport { node2js } from \"../emitter/node2js\";\n\nexport default function __JS_LOG__(...args: ASTNode[]) {\n\n    let result = \"console.log(\";\n\n    for(let i = 0; i < args.length; ++i)\n        result += node2js(args[i]) + \",\";\n\n    result += \");\"\n\n    return result;\n}","import { ASTNode } from \"../ast/types\";\nimport { node2js } from \"../emitter/node2js\";\n\nexport default function __JS_AS_STRING__(node: ASTNode) {\n    return \"`${\"+ node2js(node) + \"}`\";\n}","import { ASTNode } from \"../ast/types\";\nimport { node2js } from \"../emitter/node2js\";\n\nexport default function __JS_AS_NUMBER__(node: ASTNode) {\n    return `Number(${node2js(node)})`;\n}","import  BrythonEngineFactory from \"./Brython\";\nimport RBrythonEngineFactory from \"./RBrython\";\n\nexport default class Engines {\n    static getBrythonEngine() {\n        return  BrythonEngineFactory();\n    }\n    static getRBrythonEngine() {\n        return RBrythonEngineFactory();\n    }\n}","import RBrythonGlobalRunner from \"@RBrython/rbry/runners/RBrythonGlobalRunner\";\nimport BaseEngine from \"../Base\";\nimport parse from \"@RBrython/rbry/parser\";\nimport RBrythonEmitter from \"@RBrython/rbry/emitter\";\nimport __JS_OP__ from \"@RBrython/rbry/macros/__JS_OP__\";\nimport __JS_RUN__ from \"@RBrython/rbry/macros/__JS_RUN__\";\nimport __JS_WRITE__ from \"@RBrython/rbry/macros/__JS_WRITE__\";\nimport __JS_LOG__ from \"@RBrython/rbry/macros/__JS_LOG__\";\nimport __JS_AS_STRING__ from \"@RBrython/rbry/macros/__JS_AS_STRING__\";\nimport __JS_AS_NUMBER__ from \"@RBrython/rbry/macros/__JS_AS_NUMBER__\";\n\nexport default function RBrythonEngineFactory() {\n\n    const emitter = new RBrythonEmitter();\n    const runner  = new RBrythonGlobalRunner();\n    const engine = new BaseEngine(parse, emitter, runner);\n\n    engine.registerMacros({\n        __JS_OP__,\n        __JS_AS_STRING__,\n        __JS_AS_NUMBER__,\n        __JS_LOG__,\n        __JS_RUN__,\n        __JS_WRITE__,\n    })\n\n    engine.registerModule(\"JS\", globalThis);\n\n    const builtins = [\n        require(\"!!raw-loader!../../corelib/int.py\"  ).default,\n        require(\"!!raw-loader!../../corelib/float.py\").default,\n        require(\"!!raw-loader!../../corelib/bool.py\" ).default,\n        require(\"!!raw-loader!../../corelib/str.py\"  ).default,\n        require(\"!!raw-loader!../../corelib/mfct.py\"  ).default\n    ]\n    for(let builtin of builtins)\n        engine.registerBuiltins(builtin);\n\n    return engine;\n}","import Engines from \"@RBrython/rbry/engines\";\n\nexport const  BryEngine = Engines. getBrythonEngine();\nexport const RBryEngine = Engines.getRBrythonEngine();","import { modules } from \"@RBrython/rbry/runners/RBrythonGlobalRunner\";\n\nexport default function getModule(name: string) {\n\n    // h4ck\n    const module = modules[name];\n    if( module === undefined )\n        throw new Error(`module ${name} not found`);\n\n    return module;\n}\n    ","// interface\nimport op     from \"./interface/op\";\nimport uop    from \"./interface/uop\";\nimport call   from \"./interface/call\";\nimport mcall  from \"./interface/mcall\";\nimport assert from \"./interface/assert\";\nimport attr   from \"./interface/attr\";\nimport setattr from \"./interface/setattr\";\nimport getModule from \"./interface/getModule\";\nimport { getKW, setKW } from \"./interface/KW\";\n\nexport const $RB = {\n    // interface\n    op,\n    uop,\n    call,\n    mcall,\n    assert,\n    attr,\n    setattr,\n    getKW,\n    setKW,\n    getModule\n}\n\n//TODO: corelib\nimport { getClass } from \"./helpers/getClass\";\n\n// @ts-ignore\nglobalThis.type = function(a: unknown) { // __new__ for type...\n    return getClass(a); //TODO...\n}\n\n// @ts-ignore\nglobalThis.abs = function( a: unknown) {\n    const ka = getClass(a);\n    return ka.prototype[`__abs__`].call(a);\n}\n\n// @ts-ignore\nglobalThis.range = function*(a: number) {\n    for(let i = 0; i < a; ++i)\n        yield i;\n}\n\n// @ts-ignore\nglobalThis.Exception = function(msg: string) {\n    throw new Error(msg);\n}\n\n// =====================================================\n\n//TODO: as macro...\nexport const IVALUE = Symbol();\n\n// @ts-ignore\nglobalThis.__JS_SET_IVALUE__ = (self, v) => self[IVALUE] = v;\n// @ts-ignore\nglobalThis.__JS_GET_IVALUE__ = (self) => self[IVALUE];","import { IGNORE_ARG } from \"./KW\";\n\nexport default function mcall(o: unknown, name: string, ...args: unknown[]) {\n    \n    if( args[args.length-1] === IGNORE_ARG)\n        args = args.slice(0,-1);\n    \n    // @ts-ignore\n    let fct = o[name];\n    if( fct === undefined)\n        // @ts-ignore\n        return o.prototype[name].call(...args);\n\n    // @ts-ignore\n    return o[name](...args);\n}","import { getClass } from \"../helpers/getClass\";\n\nexport default function uop(op:string, a: unknown) {\n\n    if( op === \"not\") {\n        // @ts-ignore\n        return ! a;\n    }\n\n    const ka = getClass(a);\n\n    if( ka === undefined ) {\n        console.warn(a, op);\n        throw new Error(\"?\")\n    }\n\n    let fct = ka.prototype[`__${op}__`];\n    return fct.call(a);\n}","import \"@RBrython/rbry/runlib\";\n\nimport Runner, { PyModule } from \"./interface\";\nimport { $RB } from \"@RBrython/rbry/runlib\";\n\n// h4ck\n// @ts-ignore\nglobalThis.$RB = $RB;\n\nexport const modules: Record<string, any> = {};\n\nexport default class RBrythonGlobalRunner extends Runner {\n\n    #module   = modules; // h4ck\n    #builtins: Record<string, any> = {};\n\n    override run(jscode: string) {\n        return this.runFunction( this.loadAsFunction(jscode) );\n    }\n\n    override loadAsFunction(jscode: string): (runlib: any) => PyModule {\n        return Function(\"$RB\", jscode) as (runlib: any) => PyModule;\n    }\n    override runFunction( fct: (runlib: any) => PyModule ) {\n        return fct($RB);\n    }\n\n    // modules\n    override registerModule(name: string, symbols: PyModule): void {\n        this.#module[name] = symbols;\n    }\n    override getModule(name: string): PyModule {\n        return this.#module[name];\n    } \n\n    // builtins\n    override registerBuiltins(symbols: PyModule): void {\n        for(let name in symbols)\n            this.registerBuiltin(name, symbols[name]);\n    }\n    override registerBuiltin(name: string, value: any): void {\n        this.#builtins[name] = value;\n\n        // @ts-ignore\n        globalThis[name] = value;\n    }\n\n    /*\n    // helpers\n    override registerHelpers(helpers: Record<string, any>) {\n        for(let name in helpers)\n            this.registerHelper(name, helpers[name]);\n    }\n    override registerHelper(name: string, value: any) {\n        \n    }*/\n}","import BenchRunner, { BenchStats } from \"./utils/BenchRunner\";\nimport { BryEngine, RBryEngine } from \"./utils/engine\";\nimport printBenchStats from \"./utils/printBenchStats\";\n\nimport test_suite from \"../../tests\";\nimport { $RB } from \"@RBrython/rbry/runlib\";\n\nconst NB_REPEAT = 3;\n\nconst brython_tests = [\n    'basic test suite',\n    'numbers',\n//    \"classes\" // ~726\n//    \"strings\",\n//    \"string methods\"\n];\n// strings ~616\n// list    ~345\n// dicts   ~205\n// sets    ~224\n// bytes   ~229\n\n// generators ~972...\n\nconst search = new URLSearchParams( location.search );\nconst test_name = search.get(\"test\");\n//const merge     = __SBRY_MODE__ === \"test\"; // Benchmark\nconst merge     = search.get(\"merge\") === \"true\" ? true : false;\nconst parser    = search.get(\"parser\") === \"false\" ? false : true;\nconst DEFAULT_COMPAT = (search.get(\"compat\") ?? \"NONE\");// as typeof __SBRY_COMPAT__;\n\n////////////////////////////////////////////////////////////////:\n\nwindow.onerror = (...args) => {\n\tconsole.log(args);\n\t// msg\n\t// stack\n\t// \n}\n\n// ==================================================================\n\n// benchmark configuration...\nfunction createBench() {\n\n    const bench = new BenchRunner();\n\n    bench.addEngine( \"Brython\"    ,  BryEngine)\n            .addEngine(\"RBrython\", RBryEngine);\n\n    bench.addStep(\"parse\", (engine, ctx) => {\n        ctx.ast = engine.parse(ctx.pycode);\n    })\n            .addStep(\"emit\",  (engine, ctx) => {\n        ctx.jscode = engine.emit(ctx.ast);\n    })\n            .addStep(\"load\",  (engine, ctx) => {\n        ctx.fct = engine.loadAsFunction(ctx.jscode);\n    });\n\n    for(let i = 0; i < NB_REPEAT; ++i)\n        bench.addStep(`execute${i}`,  (_, ctx) => { ctx.fct($RB); });\n    \n    bench.addStat(\"nbTokens\", (ctx) => {\n        return $B.tokenizer(ctx.pycode, '_').length;\n    })\n    bench.addStat(\"nbFiles\", (ctx) => {\n        return 1;\n    })\n    bench.addStat(\"asserts_count\", (ctx) => {\n        const n = assert_count / NB_REPEAT;\n        assert_count = 0;\n        return n;\n    })\n    bench.addStat(\"asserts_fail\", (ctx) => {\n        const n = assert_fail / NB_REPEAT;\n        assert_fail = 0;\n        return n;\n    })\n\n    let assert_count = 0;\n    let assert_fail  = 0;\n\n    // @ts-ignore\n    $RB.assert = function(cond) {\n        ++assert_count;\n        if( ! cond )\n            ++assert_fail;\n    }\n\n    bench.resetStats();\n\n    return bench;\n}\n\n// ==================================================================\n\nfunction resetGUI() {\n    sbry_output.classList.remove('error', 'success');\n    sbry_output.textContent = \"\";\n\n    bry_output.classList.remove('error', 'success');\n    bry_output.textContent = \"\";\n\n}\nfunction printResult( target: Element,\n                      result: BenchStats,\n                        base: BenchStats) {\n\n    target.textContent = printBenchStats(result, base);\n    target.classList.add(\"success\");\n    if( result.errors.length > 0) {\n        console.warn(result.errors);\n\n        target.classList.add(\"error\");\n        target.textContent += \"\\n\" + result.errors.map( e => {\n            let msg = e.message;\n            if( msg === \"\")\n                // @ts-ignore\n                msg = e.args[0]; // Brython errors.\n            return msg;\n        }).join('\\n');\n        //TODO: show code...\n    }\n}\n\nfunction run(pycodes: string[]) {\n\n    resetGUI();\n\n    bench.resetStats();\n\n    //TODO: handle errors...\n    for(let i = 0; i < pycodes.length; ++i)\n        bench.bench({pycode: pycodes[i]});\n\n    const results = bench.getStats();\n\n    if( pycodes.length === 1) {\n          python_input.textContent = results.Brython.ctx.pycode;\n         bry_js_output.textContent = results. Brython.ctx.jscode;\n        sbry_js_output.textContent = results.RBrython.ctx.jscode;\n    }\n\n    printResult(bry_output , results[ \"Brython\"], results[\"RBrython\"]);\n    printResult(sbry_output, results[\"RBrython\"], results[ \"Brython\"]);  \n}\n\n// ==================================================================\n// Get test suite....\n\nfunction generateTestSuite(test_name: string, merge: boolean): string[] {\n    \n    let tests: string[] = [test_name];\n    if( test_name === \"brython\" )\n        tests = brython_tests;\n\n    let fullcode = \"\";\n    const pycodes = new Array<string>();\n    let id = -1;\n\n    const configs = [\"NONE\"];\n    /*\n    const configs: typeof __SBRY_COMPAT__[] = __SBRY_COMPAT__ === \"NONE\"\n        ? [\"NONE\"]\n        : [\"NONE\", \"PERF\"]; //, \"FULL\"];\n    */\n\n    //TODO: split merge & execute...\n\n    // build merged code\n    tests: for(let i = 0; i < tests.length; ++i) {\n\n        const subtests = test_suites[tests[i]];\n        const substats = subTestsStats[tests[i]];\n\n        for(let j = 0; j < subtests.length; ++j) {\n\n            ++id;\n\n            //const stats = substats[j];\n            //results.total_lines       += stats.total;\n            //results.nb_excluded_lines += stats.excluded;\n\n            for(const config of configs) {\n\n                //globalThis.__SBRY_COMPAT__ = config as any;\n                //TODO: second exclude...\n\n                let code = subtests[j];\n\n                if( code === \"\")\n                    continue;\n\n                code = filterCode(code);\n        \n                if( merge ) {\n                    const indented_code = code.split('\\n').map(e => `    ${e}`).join('\\n');\n                    fullcode += `def _${id}():\\n${indented_code + \"pass\"}\\n_${id}()\\n`;\n                } else {\n                    pycodes.push(code);\n                }\n            }\n        }\n    }\n\n    if(merge)\n        return [fullcode];\n\n    return pycodes;\n}\n\nasync function loadExcludeList() {\n    const exclude_list = await (await fetch('/assets/exclude_list.txt')).text();\n    return Object.fromEntries( exclude_list.split('#').slice(0).map(e => {\n\n        let lines = e.split('\\n');\n        let name = lines[0].slice(1);\n\n        let exclude = lines.slice(1).filter(e => e[0] !== '/' && e.length !== 0).map( x => {\n            const e = x.split('-');\n            if( e.length === 1) {\n                if( e[0] === '*')\n                    return e[0];\n                return parseInt(e[0]);\n            }\n            return [parseInt(e[0]), parseInt(e[1])]\n        });\n\n        return [name, exclude];\n    }) );\n}\n\nasync function loadTests(...names: string[]) {\n\n    const tests: Record<string, string[]> = {};\n\n    for(let i = 0; i < names.length; ++i)\n        tests[names[i]] = await loadSubTests(names[i]);\n\n    return tests;\n}\n\nasync function loadSubTests(test_name: string, exclude = exclude_list) {\n\n    const code = await (await fetch(`/assets/unittests/${test_name}.py`)).text();\n\n    subTestsStats[test_name] = [];\n\n    const parts = code.split('\\n#');\n\n    parts[0] = parts[0].slice(1);\n\n    return parts.map( (t,idx) => {\n\n        let   lines = t.split('\\n');\n        const name  = lines[0].trim();\n        lines[0] = \"# \" + test_name + \".\" + name + \" (\" + (idx+1) + \"/\" + parts.length + \")\";\n        const fullname = `${test_name}.${name}`;\n\n        let excl = exclude[fullname];\n        if( excl === undefined)\n            excl = exclude[`${test_name}.*`];\n\n        lines = filter(lines, excl);\n\n        let nbEmptyLines = 0;\n        for(let i = 1; i < lines.length; ++i)\n            if(lines[i].trim() === '')\n                ++nbEmptyLines;\n        \n        let nbExcluded = 0;\n        for(let i = 1; i < lines.length; ++i) {\n            if( lines[i][0] === '#' ) {\n                if( lines[i].slice(1).trim() === '' ) // commented empty line\n                    ++nbEmptyLines;\n                else\n                    ++nbExcluded\n            }\n        }\n\n        let code_len = lines.length - 1 - nbEmptyLines;\n\n        subTestsStats[test_name].push({\n            excluded: nbExcluded,\n            total   : code_len\n        });\n    \n        if(code_len === nbExcluded)\n            return \"\";\n\n        return lines.join('\\n') + '\\n';\n    });\n}\n\nfunction filter(lines: string[], list: (number|\"*\"|number[])[]) {\n\n    list ??= [];\n    \n    let result = lines.map( (l, idx) => {\n        idx = idx + 1;\n        let excluded = list.find( (v) => {\n            if( v === '*')\n                return true;\n            if( idx === v)\n                return true;\n            if( Array.isArray(v) && v[0] <= idx && v[1] >= idx)\n                return true;\n            return false;\n        }) !== undefined;\n        \n        if( excluded )\n            return `# ${l}`;\n        return l;\n    });\n\n    return result;\n}\n\n// ===============================================================\n\nconst subTestsStats: Record<string, {total: number, excluded: number}[]> = {};\nconst exclude_list = await loadExcludeList();\nconst test_suites  = await loadTests(...brython_tests); // cf end of file for available tests\n\n// ===============================================================\n\nconst  bry_output  = document.querySelector ( '.brython_output')!;\nconst sbry_output  = document.querySelector('.rbrython_output')!;\nconst python_input = document.querySelector<HTMLInputElement>('#python')!;\n\nconst python_output = document.querySelector(\".python_ouput\")!;\nconst ast_output    = document.querySelector(\"#ast\")!;\nconst sbry_js_output= document.querySelector(\"#rbry_js\")!;\nconst  bry_js_output= document.querySelector(\"#bry_js\")!;\n\nconst sbry_print = (...args: any[]) => {\n    console.log(\"[SBRY]\", ...args);\n}\n\npython_input.addEventListener(\"input\",\n    () => {\n        const code = python_input.value;\n        localStorage.setItem('rbrython_code', code);\n        run([code]);\n    });\n\npython_input.addEventListener('keydown', (ev) => {\n\n    if(ev.code === \"Tab\") {\n            ev.preventDefault();\n    \n            let beg = python_input.selectionStart!;\n            let end = python_input.selectionEnd!;\n    \n            const txt = python_input.value;\n            const preText  = txt.slice(0  , beg);\n            const postText = txt.slice(end, txt.length);\n    \n            python_input.value = preText + \"    \" + postText; // input tab key\n            \n            const pos = beg+4;\n            python_input.setSelectionRange(pos, pos);\n        }\n    });\n\nconst select = document.querySelector<HTMLSelectElement>('#tests')!;\n\nconst defaultOpt = new Option(\"----\", undefined, true, true);\ndefaultOpt.toggleAttribute('disabled');\nselect.append( defaultOpt );\n\nfor(let name in test_suite)\n    select.append( new Option(name, test_suite[name as keyof typeof test_suite]) );\n\n\nfunction filterCode(code: string) {\n\n    const codes = code.split(\"\\n\");\n    for(let l = 1; l < codes.length; ++l) {\n        const idx = codes[l].indexOf('#');\n        if( idx <= 0)\n            continue;\n        const config = JSON.parse( codes[l].slice(idx+1).trim());\n        if( config.COMPAT !== DEFAULT_COMPAT )\n            codes[l] = \"#\" + codes[l];\n        else\n            codes[l] = codes[l].slice(0, idx).trimEnd();\n    }\n\n    return codes.join('\\n');\n}\n\nselect.addEventListener('change', () => {\n\n    const code = filterCode(select.value);\n\n    python_input.value = code;\n    localStorage.setItem('rbrython_code', code);\n    run([code]);\n    \n});\n\nfor(let i = 0; i < brython_tests.length; ++i) {\n\n    const subtests = test_suites[ brython_tests[i] ];\n\n    for(let j = 0; j < subtests.length; ++j) {\n\n        const code = subtests[j];\n\n        if( code === \"\")\n            continue;\n\n        const name = code.slice(2 , code.indexOf(\"\\n\") );\n\n        const opts = new Option(name, code);\n        select!.append( opts );\n    }\n}\n\n// =====================================================================\n\nconst bench = createBench();\nlet initialRun: string[];\n\nif( test_name === \"rbrython\" ) {\n    initialRun = Object.values(test_suite);\n} else if( test_name !== null )\n    initialRun = generateTestSuite(test_name, merge);\nelse\n    initialRun = [python_input.value = localStorage.getItem('rbrython_code') ?? \"\"];\n\nrun( initialRun );","export let KW: Record<string, any>|null = null;\n\nexport const IGNORE_ARG = Symbol();\n\nexport function setKW(args: Record<string, any>) {\n    KW = args;\n    return IGNORE_ARG;\n}\n\nexport function getKW() {\n    if( KW === null )\n        return {};\n    const args = KW;\n    KW = null;\n    return args;\n}"],"names":["attr","o","constructor","Runner","BenchRunner","steps","engines","stats","addStat","name","fct","this","push","addEngine","engine","addStep","resetStats","r","length","Array","ctx","errors","i","time","getStats","bench","results","result","context","f","beg","performance","now","end","e","tformat","unit","toFixed","padStart","tdiff","a","b","c","printBenchStats","base","report","passed","asserts_count","asserts_fail","passed_rate","nb_tokens","nbTokens","nbFiles","jscode","tcoef","cmp","padEnd","mapper","getClass","typename","type","lit_class","globalThis","undefined","Error","setattr","obj","key","value","NotImplemented","Symbol","op","ka","console","warn","prototype","call","slice","defaults","kb","eq","assert","cond","isClass","Object","getOwnPropertyDescriptors","writable","args","IGNORE_ARG","__call__","__new__","factory","self","init","__init__","__eq__","require","parse","pycode","filename","parser","$B","Parser","ast","_PyPegen","run_parser","future","future_features","symtable","_PySymtable_Build","RBrythonGlobalRunner","run","runFunction","loadAsFunction","imported","Function","registerBuiltins","symbols","registerBuiltin","builtins","jsobj2pyobj","registerModule","getModule","Engine","FunctionTarget","exported","join","BaseEngine","emitter","runner","super","opts","emit","target","registerMacros","macros","registerMacro","parsed","nodeType","node","$name","getOp","node2js","symtab","handler","Handlers","body","res","binops","Add","Sub","Mult","Div","Pow","Mod","BitOr","BitAnd","LShift","RShift","cmpops","Eq","NotEq","uops","Invert","USub","Not","csymtab","children","find","str","bases","includes","id","Body","isMethod","fsymtab","decorator_list","selfname","posonlyargs","arg","pos_offset","arg_offset","mode","MODE","PROD","test","prefix","targets","opname","left","right","func","keywords","m","ops","comparators","operand","qname","__class__","__qualname__","DEBUG","values","orelse","snode","iter","handlers","subject","cases","pattern","cls","exc","module","names","jsop","EmitterDefaults","Emitter","RBrythonEmitter","extractExportedSymbols","$strings","keys","filter","k","BrythonEmitter","js_from_root","src","js","__JS_OP__","__JS_RUN__","replaceAll","map","__JS_WRITE__","code","__JS_LOG__","__JS_AS_STRING__","__JS_AS_NUMBER__","Engines","getBrythonEngine","BrythonGlobalRunner","BrythonEngineFactory","getRBrythonEngine","builtin","RBrythonEngineFactory","BryEngine","RBryEngine","modules","$RB","uop","mcall","getKW","setKW","abs","range","Exception","msg","IVALUE","__JS_SET_IVALUE__","v","__JS_GET_IVALUE__","NB_REPEAT","brython_tests","search","URLSearchParams","location","test_name","get","merge","DEFAULT_COMPAT","createBench","_","tokenizer","n","assert_count","assert_fail","printResult","textContent","classList","add","message","pycodes","sbry_output","remove","bry_output","python_input","Brython","bry_js_output","sbry_js_output","RBrython","generateTestSuite","tests","fullcode","configs","subtests","test_suites","subTestsStats","j","config","filterCode","split","async","loadExcludeList","exclude_list","fetch","text","fromEntries","lines","exclude","x","parseInt","loadTests","loadSubTests","parts","t","idx","trim","excl","nbEmptyLines","nbExcluded","code_len","excluded","total","list","l","isArray","window","onerror","log","document","querySelector","addEventListener","localStorage","setItem","ev","preventDefault","selectionStart","selectionEnd","txt","preText","postText","pos","setSelectionRange","select","defaultOpt","Option","toggleAttribute","append","test_suite","codes","indexOf","JSON","COMPAT","trimEnd","initialRun","getItem","KW"],"sourceRoot":""}